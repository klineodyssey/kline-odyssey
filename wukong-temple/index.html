<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>æ‚Ÿç©ºå®‡å®™ç¥æ®¿é£›ç¢Ÿ V4.3 FULL</title>
<style>
  :root{
    --bg:#0b1220;
    --panel:#0f1b33;
    --panel2:#0b162c;
    --line:#24324f;
    --txt:#e8eefc;
    --muted:#a9b7d6;
    --ok:#2dd4bf;
    --warn:#fbbf24;
    --bad:#fb7185;
    --btn:#ffffff;
    --btnTxt:#000000;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans TC", Arial, sans-serif;
    background: radial-gradient(1000px 700px at 20% 0%, #172554 0%, rgba(23,37,84,0) 55%),
                radial-gradient(900px 650px at 90% 10%, #134e4a 0%, rgba(19,78,74,0) 55%),
                var(--bg);
    color:var(--txt);
    padding:16px 14px 90px;
  }
  a{color:inherit}
  .topbar{
    position:sticky; top:0; z-index:9990;
    backdrop-filter: blur(10px);
    background: linear-gradient(to bottom, rgba(11,18,32,.92), rgba(11,18,32,.70));
    border-bottom:1px solid rgba(36,50,79,.6);
    padding:10px 2px 10px;
    margin:-16px -14px 14px;
  }
  .topbar-inner{
    display:flex; align-items:center; justify-content:space-between;
    gap:10px; padding:0 12px;
  }
  .brand{
    display:flex; flex-direction:column; gap:2px;
  }
  .brand b{font-size:14px; letter-spacing:.6px}
  .brand span{font-size:12px; color:var(--muted)}
  .pill{
    display:inline-flex; align-items:center; gap:8px;
    padding:9px 12px; border-radius:999px;
    border:1px solid rgba(17,17,17,.2);
    background: #fff;
    color:#000;
    font-weight:900;
    text-decoration:none;
    box-shadow: 0 10px 30px rgba(0,0,0,.25);
    white-space:nowrap;
  }
  .grid{
    display:grid;
    grid-template-columns: 1fr;
    gap:12px;
  }
  @media (min-width: 900px){
    .grid{grid-template-columns: 1.05fr .95fr;}
  }
  .card{
    background: linear-gradient(180deg, rgba(15,27,51,.94), rgba(11,22,44,.94));
    border:1px solid rgba(36,50,79,.9);
    border-radius:16px;
    box-shadow: 0 20px 60px rgba(0,0,0,.35);
    overflow:hidden;
  }
  .card-h{
    padding:14px 14px 10px;
    border-bottom:1px solid rgba(36,50,79,.75);
    display:flex; align-items:center; justify-content:space-between; gap:10px;
  }
  .card-h h2{
    margin:0; font-size:14px; letter-spacing:.4px;
  }
  .card-h .sub{font-size:12px; color:var(--muted)}
  .card-b{padding:14px}
  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  .row > *{flex:1}
  .mini{
    background: rgba(11,22,44,.6);
    border:1px solid rgba(36,50,79,.75);
    border-radius:14px;
    padding:12px;
  }
  .mini h3{margin:0 0 6px; font-size:12px; color:var(--muted); font-weight:700}
  .big{
    font-size:18px; font-weight:900; letter-spacing:.3px;
  }
  .small{font-size:12px; color:var(--muted)}
  .btn{
    appearance:none;
    border:none;
    border-radius:12px;
    padding:10px 12px;
    font-weight:900;
    cursor:pointer;
    background:var(--btn);
    color:var(--btnTxt);
  }
  .btn2{
    appearance:none;
    border:1px solid rgba(36,50,79,.9);
    background: rgba(11,22,44,.65);
    color: var(--txt);
    border-radius:12px;
    padding:10px 12px;
    font-weight:900;
    cursor:pointer;
  }
  .btn:disabled,.btn2:disabled{opacity:.45; cursor:not-allowed}
  .tabs{
    display:flex; gap:8px; flex-wrap:wrap;
  }
  .tab{
    padding:9px 10px; border-radius:999px;
    border:1px solid rgba(36,50,79,.9);
    background: rgba(11,22,44,.65);
    color: var(--txt);
    font-weight:900; cursor:pointer;
  }
  .tab.active{
    background:#fff; color:#000; border-color: rgba(17,17,17,.2);
  }
  .hidden{display:none !important}
  input[type="range"]{width:100%}
  input[type="number"], input[type="text"], textarea, select{
    width:100%;
    border-radius:12px;
    border:1px solid rgba(36,50,79,.85);
    background: rgba(7,14,28,.7);
    color: var(--txt);
    padding:10px 12px;
    outline:none;
  }
  textarea{min-height:80px; resize:vertical}
  .sep{height:1px; background: rgba(36,50,79,.75); margin:12px 0}
  .meter{
    width:100%;
    height:12px;
    border-radius:999px;
    border:1px solid rgba(36,50,79,.9);
    background: rgba(7,14,28,.75);
    overflow:hidden;
  }
  .meter > div{
    height:100%;
    width:0%;
    background: linear-gradient(90deg, #22c55e, #eab308, #fb7185);
  }
  .log{
    background: rgba(7,14,28,.75);
    border:1px solid rgba(36,50,79,.9);
    border-radius:14px;
    padding:10px 12px;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    font-size:11px;
    max-height:190px;
    overflow:auto;
    line-height:1.55;
  }
  .kpi{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:10px;
  }
  @media (min-width: 900px){
    .kpi{grid-template-columns: repeat(4, 1fr);}
  }
  .badge{
    display:inline-flex; align-items:center; gap:6px;
    padding:6px 10px; border-radius:999px;
    border:1px solid rgba(36,50,79,.9);
    background: rgba(11,22,44,.65);
    font-size:12px; color:var(--muted); font-weight:800;
  }
  .badge.ok{color: #a7f3d0}
  .badge.warn{color:#fde68a}
  .badge.bad{color:#fecdd3}
  .avatar{
    width:96px; height:96px; border-radius:999px;
    display:grid; place-items:center;
    margin: 6px auto 12px;
    background: radial-gradient(circle at 30% 30%, rgba(45,212,191,.8), rgba(45,212,191,0) 55%),
                radial-gradient(circle at 70% 70%, rgba(59,130,246,.8), rgba(59,130,246,0) 55%),
                rgba(255,255,255,.06);
    border:1px solid rgba(36,50,79,.9);
    box-shadow: 0 0 30px rgba(45,212,191,.15);
  }
  .avatar svg{opacity:.95}
  .sticky-actions{
    position:fixed;
    left:0; right:0; bottom:0;
    background: linear-gradient(to top, rgba(11,18,32,.96), rgba(11,18,32,.55));
    border-top:1px solid rgba(36,50,79,.75);
    padding:10px 12px calc(10px + env(safe-area-inset-bottom));
    z-index:9991;
  }
  .sticky-actions .row{gap:8px}
  .hint{font-size:12px; color:var(--muted); margin-top:8px}
</style>
</head>
<body>

<div class="topbar">
  <div class="topbar-inner">
    <div class="brand">
      <b>æ‚Ÿç©ºå®‡å®™ç¥æ®¿é£›ç¢Ÿï½œé§•é§›è‰™ + ä¸‹å–®æ¡Œ + AIå®¢æœ</b>
      <span id="bootLine">boot_version=v4.3-ufo-fullpack</span>
    </div>

    <a class="pill" href="https://klineodyssey.github.io/kline-odyssey/" target="_blank" rel="noopener">
      ğŸ’– å®‡å®™ç´°åŒ…ï½œå‘¼å¸ï½œå¿ƒè·³ï½œç”Ÿå‘½ğŸ”¥
    </a>
  </div>
</div>

<div class="grid">

  <!-- LEFT: Cockpit + Order Desk -->
  <div class="card">
    <div class="card-h">
      <div>
        <h2>KUFO é§•é§›è‰™ï¼ˆå„€è¡¨ç‰ˆï¼‰</h2>
        <div class="sub">æ–¹å‘ç›¤ + æ§“æ¡¿ + ç‡ƒæ–™è¡€é‡ï¼ˆKGENï¼‰ + å¤šç©ºæ‰‡å€</div>
      </div>
      <div class="tabs">
        <button class="tab active" data-tab="cockpit">é§•é§›è‰™</button>
        <button class="tab" data-tab="orderdesk">ä¸‹å–®æ¡Œ</button>
        <button class="tab" data-tab="temple">å¤–æ®¿</button>
      </div>
    </div>

    <div class="card-b">
      <!-- Cockpit -->
      <div id="tab_cockpit">
        <div class="kpi">
          <div class="mini">
            <h3>è³ªé‡ï¼ˆKGENï¼‰</h3>
            <div class="big"><span id="massKgen">30000</span> KGEN</div>
            <div class="small">è¦å‰‡ï¼š1 æŒ‡æ•¸é» = 1 KGENï¼ˆè·¨å¸‚å ´é€šç”¨ï¼‰</div>
          </div>
          <div class="mini">
            <h3>èƒ½é‡ï¼ˆE = m cÂ²ï¼‰</h3>
            <div class="big"><span id="energyE">30000</span> E</div>
            <div class="small">UI é¡¯ç¤ºï¼šæŠ•å…¥å¾Œæ‰åæ˜ ï¼ˆç›®å‰ä»¥ m ä½œç‚ºåŸºç¤ï¼‰</div>
          </div>
          <div class="mini">
            <h3>æ§“æ¡¿ï¼ˆ1â€“150ï¼‰</h3>
            <div class="big"><span id="lev">10</span>x</div>
            <div class="small">æ©«æ¡¿èª¿æ•´ï¼Œå½±éŸ¿æ¨¡æ“¬è¼¸è´å€ç‡</div>
          </div>
          <div class="mini">
            <h3>æ–¹å‘ç›¤ï¼ˆ0â€“360ï¼‰</h3>
            <div class="big"><span id="deg">120</span>Â°</div>
            <div class="small">0â€“170 å¤šï½œ170â€“190 ä¼‘æ¯ï½œ190â€“360 ç©º</div>
          </div>
        </div>

        <div class="sep"></div>

        <div class="row">
          <div class="mini">
            <h3>è³ªé‡ï¼ˆKGENï¼‰è¼¸å…¥</h3>
            <input id="massInput" type="number" min="0" step="1" value="30000" />
            <div class="hint">å°æŒ‡ 30000 é» = 30000 KGENï¼›BTC åŒç†ã€‚</div>
          </div>
          <div class="mini">
            <h3>æ§“æ¡¿æ»‘æ¡¿</h3>
            <input id="levRange" type="range" min="1" max="150" value="10" />
            <div class="small">ç›®å‰ï¼š<b id="levRangeLabel">10</b>x</div>
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <div class="mini">
            <h3>æ–¹å‘ç›¤æ»‘æ¡¿</h3>
            <input id="degRange" type="range" min="0" max="360" value="120" />
            <div class="small">
              ç›®å‰ï¼š<b id="degRangeLabel">120</b>Â°ï½œ
              ç‹€æ…‹ï¼š<b id="stanceLabel">å¤š</b>
            </div>
          </div>
          <div class="mini">
            <h3>ç‡ƒæ–™ / è¡€é‡ï¼ˆç”¨ KGEN è¡¨ç¤ºï¼‰</h3>
            <div class="meter"><div id="fuelBar"></div></div>
            <div class="small" style="margin-top:8px">
              <b id="fuelLabel">60%</b>ï½œ
              ä¸Šé™ï¼š<span id="fuelMaxLabel">50000</span> KGENï½œ
              ç¾åœ¨ï¼š<span id="fuelNowLabel">30000</span> KGEN
            </div>
          </div>
        </div>

        <div class="sep"></div>

        <div class="row">
          <button class="btn" id="btnHeartbeat">å¿ƒè·³</button>
          <button class="btn" id="btnBreath">å‘¼å¸</button>
          <button class="btn" id="btnPressure">å£“åŠ›</button>
          <button class="btn" id="btnCup">æ“²ç­Š</button>
          <button class="btn" id="btnFortune">æ±‚ç±¤</button>
        </div>
        <div class="hint">ä»¥ä¸Šç‚º UI äº‹ä»¶å›è·¯æ¸¬è©¦ï¼ˆæ¯é¡†æŒ‰éµå¿…æœ‰åæ‡‰ + logï¼‰ã€‚</div>

        <div class="sep"></div>

        <div class="row">
          <button class="btn2" id="btnSelfTest">ä¸€éµè‡ªæˆ‘æª¢æ¸¬</button>
          <button class="btn2" id="btnExportState">åŒ¯å‡ºç‹€æ…‹ï¼ˆJSONï¼‰</button>
          <button class="btn2" id="btnImportState">åŒ¯å…¥ç‹€æ…‹ï¼ˆJSONï¼‰</button>
          <button class="btn2" id="btnCopyLog">è¤‡è£½ Log</button>
        </div>

        <div class="sep"></div>
        <div class="log" id="log"></div>
      </div>

      <!-- Order Desk -->
      <div id="tab_orderdesk" class="hidden">
        <div class="mini">
          <h3>ä¸‹å–®æ¡Œï¼ˆT+2ï¼‰</h3>
          <div class="small">
            äº¤æ˜“æ—¥æ¡ T+2 çµç®—ã€‚ç„¡é€±ä¸‰çµç®—æ¦‚å¿µã€‚<br>
            è¦å‰‡ï¼šåœåˆ©èˆ‡åœæåŒä¸€çµç®—æ—¥åŒæ™‚è§¸ç™¼ â†’ è¦–ç‚º 0ï¼ˆä¸ç®—è¼¸è´ï¼‰ã€‚
          </div>
        </div>

        <div class="sep"></div>

        <div class="row">
          <div class="mini">
            <h3>äº¤æ˜“æ—¥</h3>
            <input id="tradeDate" type="text" placeholder="YYYY-MM-DD" />
            <div class="small">é è¨­ä»Šæ—¥ï¼ˆæœ¬æ©Ÿï¼‰ã€‚</div>
          </div>
          <div class="mini">
            <h3>T+2 çµç®—æ—¥ï¼ˆè‡ªå‹•ï¼‰</h3>
            <input id="settleDate" type="text" disabled />
            <div class="small">ä»¥ã€Œäº¤æ˜“æ—¥ + 2 å¤©ã€è¨ˆï¼ˆç°¡åŒ–ç‰ˆï¼‰ã€‚</div>
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <div class="mini">
            <h3>åœæï¼ˆKGEN é»ï¼‰</h3>
            <input id="sl" type="number" step="1" value="200" />
            <div class="small">æœ€å¤§å»ºè­°ï¼šÂ± ATR14</div>
          </div>
          <div class="mini">
            <h3>åœåˆ©ï¼ˆKGEN é»ï¼‰</h3>
            <input id="tp" type="number" step="1" value="300" />
            <div class="small">æœ€å¤§å»ºè­°ï¼šÂ± ATR14</div>
          </div>
          <div class="mini">
            <h3>ATR14ï¼ˆä¸Šé™ï¼‰</h3>
            <input id="atr14" type="number" step="1" value="500" />
            <div class="small">æœ¬ç‰ˆç‚ºæ‰‹å‹•å¡«å…¥ï¼ˆä¹‹å¾Œå¯æ¥è³‡æ–™ï¼‰ã€‚</div>
          </div>
        </div>

        <div class="sep"></div>

        <div class="row">
          <div class="mini">
            <h3>æ¨¡æ“¬çµæœï¼ˆKGENï¼‰</h3>
            <div class="big"><span id="pnlKgen">0</span></div>
            <div class="small">åŸºæ–¼æ–¹å‘ç›¤ï¼ˆå¤š/ç©ºï¼‰ + æ§“æ¡¿ + SL/TP/ATR14 ä¸Šé™</div>
          </div>
          <div class="mini">
            <h3>èªªæ˜ï¼ˆå®¢æœå£å¾‘ï¼‰</h3>
            <textarea id="csNote"></textarea>
          </div>
        </div>

        <div class="sep"></div>

        <div class="row">
          <button class="btn" id="btnSimWin">æ¨¡æ“¬è´</button>
          <button class="btn" id="btnSimLose">æ¨¡æ“¬è¼¸</button>
          <button class="btn2" id="btnSaveOrder">ä¿å­˜é€™ç­†å–®</button>
          <button class="btn2" id="btnExportOrders">åŒ¯å‡ºè¨‚å–®ï¼ˆJSONï¼‰</button>
        </div>

        <div class="sep"></div>
        <div class="log" id="ordersLog"></div>
      </div>

      <!-- Temple -->
      <div id="tab_temple" class="hidden">
        <div class="mini">
          <h3>å¤–æ®¿ï¼ˆè§€å…‰/ç•™å¿µ/é¦™æ²¹éŒ¢ï¼‰</h3>
          <div class="small">
            13 ç”Ÿè‚– / å…‰æ˜ç‡ˆ / ä¸ƒä»™å¥³è¨±é¡˜ / é‚„é¡˜ / ç™¼è²¡é‡‘ç´€éŒ„ï¼šå±¬æ–¼å¤–æ®¿æ–‡åŒ–å±¤ã€‚<br>
            èˆ‡äº¤æ˜“åˆ†å±¤éš”é›¢ï¼Œä¸è®“ã€Œå»Ÿè®Šäº¤æ˜“æ‰€ã€ã€‚
          </div>
        </div>

        <div class="sep"></div>

        <div class="row">
          <div class="mini">
            <h3>ç”Ÿè‚–</h3>
            <select id="zodiac">
              <option>é¼ </option><option>ç‰›</option><option>è™</option><option>å…”</option><option>é¾</option><option>è›‡</option>
              <option>é¦¬</option><option>ç¾Š</option><option>çŒ´</option><option>é›</option><option>ç‹—</option><option>è±¬</option>
              <option>ç¬¬13ç”Ÿè‚–ï¼ˆå®‡å®™ï¼‰</option>
            </select>
            <div class="small">é»ç‡ˆç•™å¿µä¸ç­‰æ–¼äº¤æ˜“ç­‰ç´šã€‚</div>
          </div>
          <div class="mini">
            <h3>å…‰æ˜ç‡ˆé‡‘é¡ï¼ˆKGENï¼‰</h3>
            <input id="lampFee" type="number" value="5" min="0" step="1" />
            <div class="small">è§€å…‰å®¢é»ç‡ˆè²»ç”¨ï¼ˆç¤ºæ„ï¼‰ã€‚</div>
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <div class="mini">
            <h3>ä¸ƒä»™å¥³è¨±é¡˜</h3>
            <textarea id="wish" placeholder="å¯«ä¸‹ä½ çš„é¡˜æœ›ï¼ˆç•™å¿µç”¨ï¼‰"></textarea>
          </div>
          <div class="mini">
            <h3>é‚„é¡˜ï¼ˆå‚™è¨»ï¼‰</h3>
            <textarea id="vow" placeholder="é‚„é¡˜èªªæ˜ï¼ˆç•™å¿µç”¨ï¼‰"></textarea>
          </div>
        </div>

        <div class="sep"></div>

        <div class="row">
          <button class="btn" id="btnLamp">é»å…‰æ˜ç‡ˆ</button>
          <button class="btn" id="btnWish">é€å‡ºè¨±é¡˜</button>
          <button class="btn" id="btnVow">é€å‡ºé‚„é¡˜</button>
          <button class="btn2" id="btnExportTemple">åŒ¯å‡ºå¤–æ®¿ï¼ˆJSONï¼‰</button>
        </div>

        <div class="sep"></div>
        <div class="log" id="templeLog"></div>
      </div>
    </div>
  </div>

  <!-- RIGHT: AI Customer Service -->
  <div class="card">
    <div class="card-h">
      <div>
        <h2>AI å½±åƒèªéŸ³å®¢æœ</h2>
        <div class="sub">è‡ªå‹•åµæ¸¬ STT/TTSï½œä¸æ”¯æ´æ™‚è‡ªå‹•é™ç´š</div>
      </div>
      <div class="row" style="flex-wrap:nowrap; gap:8px">
        <span class="badge" id="bTTS">TTS</span>
        <span class="badge" id="bSTT">STT</span>
        <span class="badge" id="bETH">Wallet</span>
      </div>
    </div>

    <div class="card-b">
      <div class="avatar" id="aiAvatar" aria-label="AI Avatar">
        <svg width="62" height="62" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M32 6C22 6 14 14 14 24v10c0 10 8 18 18 18s18-8 18-18V24C50 14 42 6 32 6Z" stroke="rgba(232,238,252,.92)" stroke-width="2.6"/>
          <path d="M22 28c3-4 17-4 20 0" stroke="rgba(45,212,191,.92)" stroke-width="3" stroke-linecap="round"/>
          <path d="M23 39c6 6 12 6 18 0" stroke="rgba(59,130,246,.92)" stroke-width="3" stroke-linecap="round"/>
          <circle cx="25" cy="25" r="2.8" fill="rgba(232,238,252,.9)"/>
          <circle cx="39" cy="25" r="2.8" fill="rgba(232,238,252,.9)"/>
        </svg>
      </div>

      <div class="mini">
        <h3>å®¢æœè¼¸å…¥</h3>
        <textarea id="aiInput" placeholder="ä½ å¯ä»¥æ‰“å­—å•ï¼šéŒ¢åŒ…æ€éº¼è£ï¼Ÿæ€éº¼ä¸‹å–®ï¼ŸT+2 æ€éº¼ç®—ï¼Ÿ"></textarea>
        <div class="row" style="margin-top:10px">
          <button class="btn" id="btnAsk">é€å‡º</button>
          <button class="btn2" id="btnTTS">èªéŸ³å”¸å‡º</button>
          <button class="btn" id="btnSTT">èªéŸ³è¼¸å…¥</button>
          <button class="btn2" id="btnStopSTT">åœæ­¢</button>
        </div>
        <div class="hint" id="aiHint"></div>
      </div>

      <div class="sep"></div>

      <div class="mini">
        <h3>å®¢æœå›è¦†</h3>
        <div id="aiAnswer" class="small" style="text-align:left; line-height:1.7"></div>
      </div>

      <div class="sep"></div>

      <div class="mini">
        <h3>éŒ¢åŒ…æ•™å­¸ï¼ˆå¾ 0 åˆ°èƒ½ä¸‹å–®ï¼‰</h3>
        <div class="small" style="text-align:left; line-height:1.7">
          1) å…ˆæº–å‚™ EVM éŒ¢åŒ…ï¼ˆMetaMaskï¼‰ã€‚<br>
          2) åˆ‡åˆ° BNB Chainï¼ˆBSC / BEP20ï¼‰ã€‚<br>
          3) åŒ¯å…¥ KGEN ä»£å¹£åˆç´„åœ°å€ï¼ˆä½ å·²éƒ¨ç½²çš„ KGENï¼‰ã€‚<br>
          4) æº–å‚™å°‘é‡ BNB ä½œ gasã€‚<br>
          5) æœ¬ç‰ˆä¸‹å–®æ¡Œç‚º T+2 æ¨¡æ“¬ï¼›è¦ä¸ŠéˆçœŸä¸‹å–®éœ€è¦æ¥ã€Œå¿ƒè‡Ÿ/ç„¡äººéŠ€è¡Œ/å¤§è…¦ã€è¡€ç®¡ï¼Œåˆ†å·¥æ¸…æ¥šæ‰ä¸æ’æ–¥ã€‚
        </div>
      </div>
    </div>
  </div>

</div>

<div class="sticky-actions">
  <div class="row">
    <button class="btn" id="btnModeCockpit">å›é§•é§›è‰™</button>
    <button class="btn" id="btnModeOrder">å›ä¸‹å–®æ¡Œ</button>
    <button class="btn2" id="btnModeTemple">å›å¤–æ®¿</button>
    <button class="btn2" id="btnClearLog">æ¸…ç©º Log</button>
  </div>
</div>

<script>
/* =========================
   V4.3 FULLPACK Core
   - Self detection (TTS/STT/Wallet)
   - Cross-environment safe downloads
   - No external deps
========================= */

const BOOT_VERSION = "v4.3-ufo-fullpack";
const logEl = document.getElementById("log");
const bootLine = document.getElementById("bootLine");
bootLine.textContent = "boot_version=" + BOOT_VERSION;

function nowISO(){ return new Date().toISOString(); }
function log(msg){
  if(!logEl) return;
  logEl.innerHTML += `[${nowISO()}] ${msg}<br>`;
  logEl.scrollTop = logEl.scrollHeight;
}

function safeBool(v){ return v ? "true" : "false"; }

function badge(el, state){
  el.classList.remove("ok","warn","bad");
  if(state === "ok") el.classList.add("ok");
  if(state === "warn") el.classList.add("warn");
  if(state === "bad") el.classList.add("bad");
}

function setBadgeText(el, txt){ el.textContent = txt; }

log("selfcheck_start");
log("userAgent: " + (navigator.userAgent || ""));
const hasTTS = !!window.speechSynthesis;
const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
const hasSTT = !!SR;
const hasWallet = !!window.ethereum;

log("speechSynthesis: " + safeBool(hasTTS));
log("speechRecognition: " + safeBool(hasSTT));
log("ethereum_injected_now: " + safeBool(hasWallet));

const bTTS = document.getElementById("bTTS");
const bSTT = document.getElementById("bSTT");
const bETH = document.getElementById("bETH");

setBadgeText(bTTS, "TTS " + (hasTTS ? "ON" : "OFF"));
badge(bTTS, hasTTS ? "ok" : "bad");

setBadgeText(bSTT, "STT " + (hasSTT ? "ON" : "OFF"));
badge(bSTT, hasSTT ? "ok" : "bad");

setBadgeText(bETH, "Wallet " + (hasWallet ? "ON" : "OFF"));
badge(bETH, hasWallet ? "ok" : "warn");

/* ========== Tabs ========== */
const tabs = Array.from(document.querySelectorAll(".tab"));
function showTab(key){
  document.getElementById("tab_cockpit").classList.toggle("hidden", key !== "cockpit");
  document.getElementById("tab_orderdesk").classList.toggle("hidden", key !== "orderdesk");
  document.getElementById("tab_temple").classList.toggle("hidden", key !== "temple");
  tabs.forEach(t => t.classList.toggle("active", t.dataset.tab === key));
  log("tab=" + key);
}
tabs.forEach(t => t.addEventListener("click", () => showTab(t.dataset.tab)));

document.getElementById("btnModeCockpit").onclick = () => showTab("cockpit");
document.getElementById("btnModeOrder").onclick = () => showTab("orderdesk");
document.getElementById("btnModeTemple").onclick = () => showTab("temple");

/* ========== Cockpit state ========== */
const massInput = document.getElementById("massInput");
const massKgen = document.getElementById("massKgen");
const energyE = document.getElementById("energyE");
const levRange = document.getElementById("levRange");
const levRangeLabel = document.getElementById("levRangeLabel");
const lev = document.getElementById("lev");
const degRange = document.getElementById("degRange");
const degRangeLabel = document.getElementById("degRangeLabel");
const deg = document.getElementById("deg");
const stanceLabel = document.getElementById("stanceLabel");

const fuelMaxLabel = document.getElementById("fuelMaxLabel");
const fuelNowLabel = document.getElementById("fuelNowLabel");
const fuelLabel = document.getElementById("fuelLabel");
const fuelBar = document.getElementById("fuelBar");

let state = {
  massKgen: 30000,
  leverage: 10,
  directionDeg: 120,
  fuelMax: 50000, // UI max cap; can be changed later
  lastEvents: [],
  temple: { lamps: [], wishes: [], vows: [] },
  orders: []
};

function stanceFromDeg(d){
  if(d >= 0 && d < 170) return "å¤š";
  if(d >= 170 && d <= 190) return "ä¼‘æ¯";
  return "ç©º";
}

function clamp(n, a, b){ return Math.min(b, Math.max(a, n)); }

function renderCockpit(){
  state.massKgen = clamp(parseInt(massInput.value || "0",10) || 0, 0, 10_000_000);
  massKgen.textContent = String(state.massKgen);
  // Energy: keep proportional for now (user wants mass visible; energy reflects after input)
  energyE.textContent = String(state.massKgen);

  state.leverage = clamp(parseInt(levRange.value || "1",10) || 1, 1, 150);
  levRangeLabel.textContent = String(state.leverage);
  lev.textContent = String(state.leverage);

  state.directionDeg = clamp(parseInt(degRange.value || "0",10) || 0, 0, 360);
  degRangeLabel.textContent = String(state.directionDeg);
  deg.textContent = String(state.directionDeg);
  const st = stanceFromDeg(state.directionDeg);
  stanceLabel.textContent = st;

  const fuelNow = clamp(state.massKgen, 0, state.fuelMax);
  const pct = state.fuelMax <= 0 ? 0 : Math.round((fuelNow / state.fuelMax) * 100);
  fuelMaxLabel.textContent = String(state.fuelMax);
  fuelNowLabel.textContent = String(fuelNow);
  fuelLabel.textContent = pct + "%";
  fuelBar.style.width = pct + "%";
}

massInput.addEventListener("input", () => { renderCockpit(); log("mass_changed=" + massInput.value); });
levRange.addEventListener("input", () => { renderCockpit(); log("leverage=" + levRange.value); });
degRange.addEventListener("input", () => { renderCockpit(); log("direction=" + degRange.value); });

renderCockpit();

/* ========== Event buttons (must always respond) ========== */
function pushEvent(name){
  state.lastEvents.push({t: nowISO(), e: name});
  if(state.lastEvents.length > 50) state.lastEvents.shift();
  log(name);
}

document.getElementById("btnHeartbeat").onclick = () => pushEvent("heartbeat");
document.getElementById("btnBreath").onclick = () => pushEvent("breath");
document.getElementById("btnPressure").onclick = () => pushEvent("pressure");
document.getElementById("btnCup").onclick = () => pushEvent("cup_throw");
document.getElementById("btnFortune").onclick = () => pushEvent("fortune_click");

/* ========== Selftest ========== */
document.getElementById("btnSelfTest").onclick = () => {
  log("selftest_run");
  const checks = [
    ["TTS", hasTTS],
    ["STT", hasSTT],
    ["Wallet", hasWallet],
    ["Clipboard", !!navigator.clipboard],
    ["DownloadAnchor", true]
  ];
  checks.forEach(([k,v]) => log(`selftest_${k}=${v ? "OK":"FAIL"}`));
  // Probe user interaction chain: create a tiny toast via log
  log("selftest_done");
};

/* ========== Robust JSON export/download ========== */
function downloadText(filename, text){
  try{
    const blob = new Blob([text], {type:"application/json;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 1500);
    log("export_download_try");
    return true;
  }catch(e){
    log("export_download_fail " + (e && e.message ? e.message : String(e)));
    return false;
  }
}

async function copyToClipboard(text){
  try{
    if(navigator.clipboard && navigator.clipboard.writeText){
      await navigator.clipboard.writeText(text);
      log("clipboard_copied");
      return true;
    }
  }catch(e){
    log("clipboard_copy_fail " + (e && e.message ? e.message : String(e)));
  }
  return false;
}

function exportStatePayload(){
  return {
    boot_version: BOOT_VERSION,
    exported_at: nowISO(),
    userAgent: navigator.userAgent || "",
    state: state
  };
}

document.getElementById("btnExportState").onclick = async () => {
  const payload = exportStatePayload();
  const text = JSON.stringify(payload, null, 2);
  const ok = downloadText(`wuzhishan_state_${new Date().toISOString().slice(0,10)}.json`, text);
  if(!ok){
    await copyToClipboard(text);
    alert("æ­¤ç’°å¢ƒå¯èƒ½é˜»æ“‹ä¸‹è¼‰ï¼›å·²æ”¹ç”¨å‰ªè²¼ç°¿å‚™æ´ã€‚è«‹è²¼åˆ°è¨˜äº‹æœ¬/é›²ç«¯å­˜æª”ã€‚");
  }
};

document.getElementById("btnImportState").onclick = async () => {
  const input = prompt("è«‹è²¼ä¸Š JSONï¼ˆç‹€æ…‹åŒ¯å…¥ï¼‰");
  if(!input) return;
  try{
    const obj = JSON.parse(input);
    if(!obj || !obj.state) throw new Error("bad_format");
    state = obj.state;
    // Apply to UI
    massInput.value = String(state.massKgen || 0);
    levRange.value = String(state.leverage || 1);
    degRange.value = String(state.directionDeg || 0);
    renderCockpit();
    renderOrdersLog();
    renderTempleLog();
    log("import_ok");
  }catch(e){
    log("import_fail " + (e && e.message ? e.message : String(e)));
    alert("JSON æ ¼å¼éŒ¯èª¤æˆ–ä¸ç›¸å®¹ã€‚");
  }
};

document.getElementById("btnCopyLog").onclick = async () => {
  const text = (logEl.innerText || "").trim();
  const ok = await copyToClipboard(text);
  if(!ok) alert("æ­¤ç’°å¢ƒä¸æ”¯æ´å‰ªè²¼ç°¿ã€‚è«‹æ‰‹å‹•é•·æŒ‰è¤‡è£½ã€‚");
};

document.getElementById("btnClearLog").onclick = () => {
  logEl.innerHTML = "";
  log("log_cleared");
};

/* ========== Order desk ========== */
const tradeDate = document.getElementById("tradeDate");
const settleDate = document.getElementById("settleDate");
const sl = document.getElementById("sl");
const tp = document.getElementById("tp");
const atr14 = document.getElementById("atr14");
const pnlKgen = document.getElementById("pnlKgen");
const ordersLog = document.getElementById("ordersLog");
const csNote = document.getElementById("csNote");

function pad2(n){ return String(n).padStart(2,"0"); }

function todayStr(){
  const d = new Date();
  return d.getFullYear()+"-"+pad2(d.getMonth()+1)+"-"+pad2(d.getDate());
}
tradeDate.value = todayStr();

function addDays(yyyy_mm_dd, days){
  const m = /^(\d{4})-(\d{2})-(\d{2})$/.exec(yyyy_mm_dd);
  if(!m) return "";
  const d = new Date(parseInt(m[1],10), parseInt(m[2],10)-1, parseInt(m[3],10));
  d.setDate(d.getDate() + days);
  return d.getFullYear()+"-"+pad2(d.getMonth()+1)+"-"+pad2(d.getDate());
}
function refreshSettle(){
  settleDate.value = addDays(tradeDate.value, 2) || "";
}
tradeDate.addEventListener("input", ()=>{ refreshSettle(); pushEvent("tradeDate=" + tradeDate.value); });
refreshSettle();

function capByATR(x, atr){
  const a = Math.max(0, parseInt(atr,10) || 0);
  const v = parseInt(x,10) || 0;
  return clamp(v, -a, a);
}

function computePnL(sign){
  const atr = parseInt(atr14.value,10) || 0;
  let _sl = parseInt(sl.value,10) || 0;
  let _tp = parseInt(tp.value,10) || 0;

  // Enforce ATR cap
  _sl = clamp(_sl, 0, atr);
  _tp = clamp(_tp, 0, atr);
  sl.value = String(_sl);
  tp.value = String(_tp);

  // direction sign based on stance (å¤š/ç©º/ä¼‘æ¯)
  const st = stanceFromDeg(state.directionDeg);
  let dir = 0;
  if(st === "å¤š") dir = 1;
  if(st === "ç©º") dir = -1;

  // If resting, pnl 0
  if(dir === 0){
    pnlKgen.textContent = "0";
    return 0;
  }

  // sign = "win" or "lose"
  let raw = (sign === "win" ? _tp : -_sl);

  // Multiply by leverage and direction
  let pnl = raw * state.leverage * dir;

  // Rule: if both hit same settle day, pnl 0 (simulate by special case if _sl==_tp and sign=="both")
  pnlKgen.textContent = String(pnl);
  return pnl;
}

document.getElementById("btnSimWin").onclick = () => { const v=computePnL("win"); pushEvent("simulate_win pnl=" + v); };
document.getElementById("btnSimLose").onclick = () => { const v=computePnL("lose"); pushEvent("simulate_lose pnl=" + v); };

function renderOrdersLog(){
  const lines = state.orders.map((o,i)=>`#${i+1} ${o.tradeDate} settle=${o.settleDate} stance=${o.stance} lev=${o.leverage} sl=${o.sl} tp=${o.tp} atr14=${o.atr14} pnl=${o.pnl}`);
  ordersLog.innerHTML = lines.length ? lines.join("<br>") : "(å°šç„¡è¨‚å–®)";
}

document.getElementById("btnSaveOrder").onclick = () => {
  const atr = parseInt(atr14.value,10) || 0;
  const _sl = clamp(parseInt(sl.value,10) || 0, 0, atr);
  const _tp = clamp(parseInt(tp.value,10) || 0, 0, atr);
  const st = stanceFromDeg(state.directionDeg);
  const pnl = parseInt(pnlKgen.textContent,10) || 0;

  const order = {
    id: "O" + Date.now(),
    tradeDate: tradeDate.value,
    settleDate: settleDate.value,
    stance: st,
    leverage: state.leverage,
    massKgen: state.massKgen,
    sl: _sl,
    tp: _tp,
    atr14: atr,
    pnl: pnl,
    note: (csNote.value || "").trim(),
    created_at: nowISO()
  };
  state.orders.push(order);
  if(state.orders.length > 200) state.orders.shift();
  renderOrdersLog();
  pushEvent("order_saved " + order.id);
};

document.getElementById("btnExportOrders").onclick = async () => {
  const payload = {
    boot_version: BOOT_VERSION,
    exported_at: nowISO(),
    orders: state.orders
  };
  const text = JSON.stringify(payload, null, 2);
  const ok = downloadText(`wuzhishan_orders_${new Date().toISOString().slice(0,10)}.json`, text);
  if(!ok){
    await copyToClipboard(text);
    alert("æ­¤ç’°å¢ƒå¯èƒ½é˜»æ“‹ä¸‹è¼‰ï¼›å·²æ”¹ç”¨å‰ªè²¼ç°¿å‚™æ´ã€‚");
  }
};

renderOrdersLog();

/* ========== Temple (13 zodiac / lamps / wishes) ========== */
const templeLog = document.getElementById("templeLog");
function tlog(msg){
  templeLog.innerHTML += `[${nowISO()}] ${msg}<br>`;
  templeLog.scrollTop = templeLog.scrollHeight;
}
function renderTempleLog(){
  const lastLamp = state.temple.lamps[state.temple.lamps.length-1];
  const lastWish = state.temple.wishes[state.temple.wishes.length-1];
  const lastVow = state.temple.vows[state.temple.vows.length-1];
  const lines = [];
  if(lastLamp) lines.push("lamp: " + lastLamp.zodiac + " fee=" + lastLamp.fee);
  if(lastWish) lines.push("wish: " + (lastWish.text||"").slice(0,40));
  if(lastVow) lines.push("vow: " + (lastVow.text||"").slice(0,40));
  templeLog.innerHTML = lines.length ? lines.join("<br>") : "(å¤–æ®¿å°šç„¡ç´€éŒ„)";
}
renderTempleLog();

document.getElementById("btnLamp").onclick = () => {
  const z = document.getElementById("zodiac").value;
  const fee = parseInt(document.getElementById("lampFee").value,10) || 0;
  state.temple.lamps.push({t: nowISO(), zodiac: z, fee: fee});
  if(state.temple.lamps.length > 200) state.temple.lamps.shift();
  tlog("lamp_init zodiac=" + z + " fee=" + fee);
  pushEvent("lamp_init");
  renderTempleLog();
};

document.getElementById("btnWish").onclick = () => {
  const text = (document.getElementById("wish").value || "").trim();
  state.temple.wishes.push({t: nowISO(), text});
  if(state.temple.wishes.length > 200) state.temple.wishes.shift();
  tlog("wish_submit");
  pushEvent("wish_submit");
  renderTempleLog();
};

document.getElementById("btnVow").onclick = () => {
  const text = (document.getElementById("vow").value || "").trim();
  state.temple.vows.push({t: nowISO(), text});
  if(state.temple.vows.length > 200) state.temple.vows.shift();
  tlog("vow_submit");
  pushEvent("vow_submit");
  renderTempleLog();
};

document.getElementById("btnExportTemple").onclick = async () => {
  const payload = {
    boot_version: BOOT_VERSION,
    exported_at: nowISO(),
    temple: state.temple
  };
  const text = JSON.stringify(payload, null, 2);
  const ok = downloadText(`wuzhishan_temple_${new Date().toISOString().slice(0,10)}.json`, text);
  if(!ok){
    await copyToClipboard(text);
    alert("æ­¤ç’°å¢ƒå¯èƒ½é˜»æ“‹ä¸‹è¼‰ï¼›å·²æ”¹ç”¨å‰ªè²¼ç°¿å‚™æ´ã€‚");
  }
};

/* ========== AI Customer Service (local rules, no internet) ========== */
const aiInput = document.getElementById("aiInput");
const aiAnswer = document.getElementById("aiAnswer");
const aiHint = document.getElementById("aiHint");
const btnAsk = document.getElementById("btnAsk");
const btnTTS = document.getElementById("btnTTS");
const btnSTT = document.getElementById("btnSTT");
const btnStopSTT = document.getElementById("btnStopSTT");

function ttsSpeak(text){
  if(!hasTTS){
    log("tts_not_supported");
    return false;
  }
  try{
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "zh-TW";
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(u);
    log("tts_spoken");
    return true;
  }catch(e){
    log("tts_fail " + (e && e.message ? e.message : String(e)));
    return false;
  }
}

let rec = null;
function sttStart(){
  if(!hasSTT){
    log("stt_not_supported");
    return;
  }
  try{
    rec = new SR();
    rec.lang = "zh-TW";
    rec.interimResults = false;
    rec.maxAlternatives = 1;
    rec.onresult = (ev) => {
      const text = ev.results && ev.results[0] && ev.results[0][0] ? ev.results[0][0].transcript : "";
      log("stt_text=" + text);
      aiInput.value = text;
      answerAI(text);
    };
    rec.onerror = (e) => {
      log("stt_error " + (e && e.error ? e.error : "unknown"));
      aiHint.textContent = "èªéŸ³è¼¸å…¥åœ¨æ­¤ç’°å¢ƒå¯èƒ½è¢«ä¸­æ–·ï¼ˆWebView/æ¬Šé™/æ‰‹å‹¢é™åˆ¶ï¼‰ã€‚å¯æ”¹ç”¨æ‰“å­—ã€‚";
    };
    rec.onend = () => { log("stt_stop"); };
    rec.start();
    log("stt_start");
  }catch(e){
    log("stt_fail " + (e && e.message ? e.message : String(e)));
  }
}
function sttStop(){
  try{
    if(rec){ rec.stop(); }
  }catch(e){}
}

function answerAI(q){
  const text = (q || "").trim();
  if(!text){
    aiAnswer.innerHTML = "è«‹è¼¸å…¥å•é¡Œã€‚";
    return;
  }
  const lower = text.toLowerCase();

  // Minimal deterministic local "customer service"
  let a = "";
  if(lower.includes("éŒ¢åŒ…") || lower.includes("metamask") || lower.includes("æ€éº¼è£")){
    a = "éŒ¢åŒ…æ•™å­¸ï¼šä¸€ï¼Œå®‰è£ MetaMaskã€‚äºŒï¼Œåˆ‡åˆ° BNB Chainã€‚ä¸‰ï¼ŒåŒ¯å…¥ KGEN ä»£å¹£åˆç´„åœ°å€ã€‚å››ï¼Œæº–å‚™å°‘é‡ BNB ä½œ gasã€‚äº”ï¼Œæœ¬ç‰ˆä¸‹å–®æ¡Œç›®å‰æ˜¯ T+2 æ¨¡æ“¬ï¼›è¦çœŸä¸Šéˆä¸‹å–®ï¼Œéœ€è¦æŠŠä¸‹å–®è¨Šæ¯é€é€² KUFO æˆ–å¿ƒè‡Ÿåˆç´„ï¼Œå†ç”±å¤§è…¦åšçµç®—è¦å‰‡ã€‚";
  } else if(lower.includes("t+2") || lower.includes("çµç®—")){
    a = "æœ¬å®‡å®™è¦å‰‡ï¼šæ‰€æœ‰ K ç·šäº¤æ˜“ä»¥äº¤æ˜“æ—¥ T+2 çµç®—ï¼Œä¸ç”¨é€±ä¸‰çµç®—ã€‚åœåˆ©èˆ‡åœæè‹¥åœ¨åŒä¸€çµç®—æ—¥åŒæ™‚è§¸ç™¼ï¼Œè¦–ç‚º 0ï¼ˆä¸ç®—è¼¸è´ï¼‰ã€‚";
  } else if(lower.includes("æ§“æ¡¿") || lower.includes("å€æ•¸")){
    a = "æ§“æ¡¿ 1 åˆ° 150 å€ã€‚æ§“æ¡¿åªå½±éŸ¿æ¨¡æ“¬è¼¸è´å€ç‡ï¼Œä¸æ”¹è®Šä½ æŠ•å…¥çš„è³ªé‡ï¼ˆKGENï¼‰ã€‚";
  } else if(lower.includes("æ–¹å‘") || lower.includes("å¤šç©º") || lower.includes("æ–¹å‘ç›¤")){
    a = "æ–¹å‘ç›¤ 0 åˆ° 170 åº¦æ˜¯å¤šæ–¹æ‰‡å€ï¼Œ170 åˆ° 190 åº¦æ˜¯ä¼‘æ¯å€ï¼Œ190 åˆ° 360 åº¦æ˜¯ç©ºæ–¹æ‰‡å€ã€‚ä¼‘æ¯å€è¦–ç‚ºä¸ä¸‹å–®ï¼Œè¼¸è´ç‚º 0ã€‚";
  } else if(lower.includes("åŒ¯å‡º") || lower.includes("ä¸‹è¼‰")){
    a = "è‹¥ä½ åœ¨ WebViewï¼ˆä¾‹å¦‚ MetaMask å…§å»ºç€è¦½å™¨ï¼‰é‡åˆ°ä¸‹è¼‰é˜»æ“‹ï¼Œæœ¬ç³»çµ±æœƒè‡ªå‹•æ”¹ç”¨å‰ªè²¼ç°¿å‚™æ´ã€‚ä½ ä¹Ÿå¯ä»¥ç”¨ã€è¤‡è£½ Logã€æŠŠå…§å®¹è²¼åˆ°è¨˜äº‹æœ¬ä¿å­˜ã€‚";
  } else if(lower.includes("atr14") || lower.includes("æœ€å¤§") || lower.includes("åœæ") || lower.includes("åœåˆ©")){
    a = "é¢¨æ§è¦å‰‡ï¼šæœ€å¤§è´è™§å»ºè­°é™åˆ¶åœ¨ Â±ATR14ã€‚ä¸‹å–®æ¡ŒæœƒæŠŠåœåˆ©åœæè‡ªå‹•é™åˆ¶åœ¨ ATR14 ç¯„åœå…§ï¼Œé¿å…è¶…æ¨™ã€‚";
  } else {
    a = "æˆ‘æ”¶åˆ°ä½ çš„å•é¡Œã€‚ä½ å¯ä»¥ç›´æ¥å•ï¼šéŒ¢åŒ…æ€éº¼è£ã€T+2 æ€éº¼ç®—ã€æ§“æ¡¿æ€éº¼èª¿ã€æ–¹å‘ç›¤æ€éº¼åˆ¤å¤šç©ºã€å¦‚ä½•åŒ¯å‡ºç‹€æ…‹ã€‚";
  }

  aiAnswer.innerHTML = a;
  aiHint.textContent = hasTTS ? "å¯æŒ‰ã€èªéŸ³å”¸å‡ºã€è®“å®¢æœç”¨è²éŸ³å›è¦†ã€‚" : "æ­¤ç’°å¢ƒä¸æ”¯æ´èªéŸ³å”¸å‡ºï¼ˆTTS OFFï¼‰ï¼Œå·²è‡ªå‹•é™ç´šç‚ºæ–‡å­—å®¢æœã€‚";
  pushEvent("assistant_answer");
  if(hasTTS) ttsSpeak(a);
}

btnAsk.onclick = () => answerAI(aiInput.value);
btnTTS.onclick = () => ttsSpeak(aiAnswer.innerText || "æ‚Ÿç©ºå®‡å®™å®¢æœåœ¨ç·šã€‚");
btnSTT.onclick = () => sttStart();
btnStopSTT.onclick = () => sttStop();

// Disable buttons based on support
btnTTS.disabled = !hasTTS;
btnSTT.disabled = !hasSTT;

// Initial greet
aiAnswer.innerHTML = "ä½ å¥½ï¼Œæˆ‘æ˜¯æ‚Ÿç©ºå®‡å®™ AI å®¢æœã€‚ä½ å¯ä»¥å•ï¼šéŒ¢åŒ…æ€éº¼è£ã€T+2 çµç®—ã€æ§“æ¡¿ã€æ–¹å‘ç›¤ã€å¤šç©ºè¦å‰‡ã€åŒ¯å‡ºä¸‹è¼‰ã€‚";
aiHint.textContent = "ç³»çµ±æœƒè‡ªå‹•åµæ¸¬ç’°å¢ƒï¼Œä¸åŒç€è¦½å™¨æœƒè‡ªå‹•é™ç´šã€‚";

/* ========== End ========== */
log("ready");
</script>
</body>
</html>
