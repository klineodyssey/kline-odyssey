<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æ‚Ÿç©ºè²¡ç¥æ®¿ï½œäº”æŒ‡å±±</title>
  <meta name="description" content="æ‚Ÿç©ºè²¡ç¥æ®¿ï½œå‘¼å¸ã€å¿ƒè·³ã€èªéŸ³å®¢æœã€éŒ¢åŒ…äº’å‹•ã€é‚„é¡˜èˆ‡ç™¼è²¡é‡‘ï¼ˆBSCï¼‰" />
  <style>
    :root{
      --bg:#0b1020; --card:#0f1730cc; --line:#ffffff26; --text:#e9ecff; --muted:#b8c0ffcc;
      --gold:#ffd36a; --ok:#6affc2; --shadow:0 20px 60px rgba(0,0,0,.45); --r:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;color:var(--text);
      font-family:system-ui,-apple-system,"Noto Sans TC","Microsoft JhengHei",Arial,sans-serif;
      background:
        radial-gradient(1200px 800px at 10% 10%, rgba(255,211,106,.18), transparent 55%),
        radial-gradient(900px 700px at 90% 20%, rgba(106,255,194,.12), transparent 55%),
        linear-gradient(180deg,#060913,#0b1020 55%,#060913);
    }
    a{color:inherit}
    .wrap{max-width:980px;margin:0 auto;padding:18px 14px 56px}
    .topbar{position:sticky;top:0;z-index:9;padding:10px 0 12px;background:linear-gradient(180deg,rgba(11,16,32,.92),rgba(11,16,32,.55),transparent);backdrop-filter:blur(10px)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:12px;align-items:center}
    .badge{width:44px;height:44px;border-radius:14px;display:grid;place-items:center;font-weight:900;color:var(--gold);
      background:linear-gradient(135deg,rgba(255,211,106,.30),rgba(255,211,106,.06));border:1px solid var(--line);box-shadow:var(--shadow)}
    h1{margin:0;font-size:18px}
    .sub{margin-top:3px;color:var(--muted);font-weight:800;font-size:12px}
    .pill{border:1px solid var(--line);background:rgba(255,255,255,.04);padding:10px 12px;border-radius:999px;font-weight:900;cursor:pointer;text-decoration:none}
    .pill:hover{background:rgba(255,255,255,.07)}
    .pill.gold{border-color:rgba(255,211,106,.35);background:linear-gradient(135deg,rgba(255,211,106,.22),rgba(255,211,106,.06));color:var(--gold)}
    .grid{margin-top:14px;display:grid;grid-template-columns:1.12fr .88fr;gap:12px}
    @media(max-width:920px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--r);box-shadow:var(--shadow);padding:14px}
    .muted{color:var(--muted);line-height:1.75}
    .divider{height:1px;background:var(--line);margin:12px 0}
    .kpi{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px}
    @media(max-width:520px){.kpi{grid-template-columns:1fr}}
    .box{border:1px solid var(--line);border-radius:16px;padding:12px;background:rgba(255,255,255,.03)}
    .label{font-size:12px;color:var(--muted);font-weight:900}
    .val{margin-top:6px;font-size:16px;font-weight:1000}
    .btnGrid{margin-top:10px;display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:10px}
    .btn{width:100%;min-height:44px;border-radius:14px;border:1px solid var(--line);background:rgba(255,255,255,.05);color:var(--text);font-weight:1000;cursor:pointer}
    .btn:hover{background:rgba(255,255,255,.08)}
    .btn.ok{border-color:rgba(106,255,194,.35);background:linear-gradient(135deg,rgba(106,255,194,.18),rgba(255,255,255,.04))}
    .btn.gold{border-color:rgba(255,211,106,.35);background:linear-gradient(135deg,rgba(255,211,106,.22),rgba(255,255,255,.04));color:var(--gold)}
    .toast{margin-top:10px;padding:10px 12px;border:1px dashed var(--line);border-radius:14px;background:rgba(255,255,255,.03);font-weight:900}
    .addr{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px;word-break:break-all;overflow-wrap:anywhere}
    .addr2{-webkit-line-clamp:2;display:-webkit-box;-webkit-box-orient:vertical;overflow:hidden}
    .chat{margin-top:10px;border:1px solid var(--line);border-radius:16px;overflow:hidden;background:rgba(255,255,255,.03)}
    .chatHead{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px;border-bottom:1px solid var(--line);background:rgba(255,255,255,.02)}
    .chatBody{max-height:320px;overflow:auto;padding:12px;line-height:1.7}
    .msg{border:1px solid var(--line);border-radius:16px;padding:10px 12px;margin:0 0 10px 0;background:rgba(15,23,48,.35)}
    .msg.ai{border-color:rgba(255,211,106,.25);background:rgba(255,211,106,.06)}
    .msg.me{border-color:rgba(106,255,194,.25);background:rgba(106,255,194,.06)}
    .who{font-size:12px;color:var(--muted);font-weight:1000;margin-bottom:6px}
    .inputRow{display:flex;gap:8px;flex-wrap:wrap;padding:10px 12px;border-top:1px solid var(--line);background:rgba(255,255,255,.02)}
    input{flex:1;min-width:220px;padding:12px;border-radius:14px;border:1px solid var(--line);background:rgba(0,0,0,.20);color:var(--text);font-weight:900;outline:none}
    .smallBtn{padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.04);color:var(--text);font-weight:1000;cursor:pointer}
    .smallBtn:hover{background:rgba(255,255,255,.07)}
    .foot{margin-top:16px;padding-top:12px;border-top:1px solid var(--line);color:var(--muted);line-height:1.8;font-weight:900}
  </style>
</head>

<body>
  <div class="topbar">
    <div class="wrap">
      <div class="row">
        <div class="brand">
          <div class="badge">âŒ–</div>
          <div>
            <h1>æ‚Ÿç©ºè²¡ç¥æ®¿ãƒ»äº”æŒ‡å±±</h1>
            <div class="sub">å‘¼å¸ï½œå¿ƒè·³ï½œé»ç«äº‹ä»¶ï½œèªéŸ³å®¢æœï½œéŒ¢åŒ…äº’å‹•ï¼ˆBSCï¼‰</div>
          </div>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <a class="pill gold" href="https://klineodyssey.github.io/kline-odyssey/" target="_blank" rel="noopener">ğŸŒ å®˜ç¶²å…¥å£</a>
          <button class="pill" id="btnBlueprint">ğŸ—ºï¸ å»ºæ®¿è—åœ–</button>
          <button class="pill" id="btnIntro">ğŸ”Š èªéŸ³å°è¦½</button>
        </div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="grid">
      <div class="card">
        <h2 style="margin:0 0 8px 0">ä¸»æ®¿å…¬å‘Š</h2>
        <div class="muted">
          é€™è£¡æ˜¯äº’å‹•å¼éŠæˆ²å…¥å£ï¼Œä¸æ˜¯æŠ•è³‡å¹³å°ã€‚æ‰€æœ‰éˆä¸Šå‹•ä½œéƒ½å¿…é ˆç”±ä½ åœ¨éŒ¢åŒ…ä¸­æŒ‰ç¢ºèªã€‚<br>
          è‹¥ä½ æ‰¾ä¸åˆ° KGENï¼Œè«‹ç”¨éŒ¢åŒ…çš„ã€Œè‡ªè¨‚ä»£å¹£ã€æ–°å¢åˆç´„åœ°å€ã€‚
        </div>

        <div class="divider"></div>

        <h2 style="margin:0 0 8px 0">å‘¼å¸èˆ‡å¿ƒè·³ï¼ˆå¯é©—è­‰ï¼‰</h2>
        <div class="muted">ä¾†è¨ªäººæ•¸ï¼ˆä»Šæ—¥/ç¸½è¨ˆï¼‰ç”¨ CountAPI è¨˜éŒ„ã€‚ç™¼è²¡é‡‘èˆ‡é»ç«äº‹ä»¶éœ€è¦ Faucet åˆç´„éƒ¨ç½²å¾Œæ‰èƒ½çœŸæ­£å‡ºé‡‘ã€‚</div>

        <div class="kpi">
          <div class="box"><div class="label">ğŸ‘£ ä»Šæ—¥ä¾†è¨ª</div><div class="val" id="kpiToday">â€”</div></div>
          <div class="box"><div class="label">ğŸŒ ç¸½ä¾†è¨ª</div><div class="val" id="kpiTotal">â€”</div></div>
          <div class="box"><div class="label">ğŸ”¥ å¿ƒè·³ç‹€æ…‹</div><div class="val" id="kpiIgnite">æœªéƒ¨ç½² Faucet</div></div>
        </div>

        <div class="divider"></div>

        <h2 style="margin:0 0 8px 0">éŒ¢åŒ…èˆ‡åœ°å€ï¼ˆBSCï¼‰</h2>
        <div class="btnGrid">
          <button class="btn ok" id="btnConnect">ğŸªª é€£ç·šéŒ¢åŒ…</button>
          <button class="btn" id="btnAddToken">â• æ–°å¢ KGENï¼ˆæç¤ºï¼‰</button>
          <button class="btn gold" id="btnFortune">ğŸ§§ é ˜ç™¼è²¡é‡‘</button>
          <button class="btn" id="btnVow">ğŸ™ é‚„é¡˜ï¼ˆé€å‡º KGENï¼‰</button>
          <button class="btn" id="btnBoBei">ğŸ´ åšæ¯ï¼ˆäº’å‹•éŠæˆ²ï¼‰</button>
          <a class="btn" href="../bookstore/" style="display:flex;align-items:center;justify-content:center;text-decoration:none">ğŸ“˜ æ‚Ÿç©ºæ›¸åŸ</a>
        </div>

        <div class="toast" id="panel">
          <div><b>éŒ¢åŒ…ç‹€æ…‹ï¼š</b><span id="walletState">æœªé€£ç·š</span></div>
          <div style="margin-top:6px"><b>ä½ çš„åœ°å€ï¼š</b><span class="addr" id="meAddr">â€”</span></div>
          <div style="margin-top:6px"><b>KGENï¼š</b><span class="addr addr2" id="kgenAddr"></span></div>
          <div style="margin-top:6px"><b>Faucetï¼ˆå¿ƒè‡Ÿï¼‰ï¼š</b><span class="addr addr2" id="faucetAddr"></span></div>
          <div style="margin-top:8px;opacity:.9" id="balances">ï¼ˆé€£ç·šå¾Œé¡¯ç¤ºé¤˜é¡ï¼‰</div>
        </div>

        <div class="divider"></div>

        <h2 style="margin:0 0 8px 0">é‚„é¡˜ä¸‰é“ï¼ˆé¿å…èª¤æœƒï¼‰</h2>
        <div class="muted">A Faucetï¼ˆå¿ƒè‡Ÿãƒ»å‡ºå…¥å¾ªç’°ï¼‰ B ç„¡äººéŠ€è¡Œï¼ˆåˆ¶åº¦å„²å‚™ï¼‰ C å¾€ç”Ÿåœ°å€ï¼ˆç‡ƒç‡’ãƒ»ä¸å¯é€†ï¼‰</div>
        <div style="margin-top:10px">
          <label style="display:flex;gap:10px;margin:8px 0;align-items:flex-start">
            <input type="radio" name="vowTarget" value="faucet" checked>
            <div><b>Faucetï¼ˆå¿ƒè‡Ÿï¼‰</b><div class="muted">æ¨è–¦ï¼šé¿å…å¿˜è¨˜å›è£œåœ°å€</div></div>
          </label>
          <label style="display:flex;gap:10px;margin:8px 0;align-items:flex-start">
            <input type="radio" name="vowTarget" value="bank">
            <div><b>ç„¡äººéŠ€è¡Œï¼ˆBankï¼‰</b><div class="muted">é•·æœŸå»ºæ®¿/åˆ¶åº¦è³‡é‡‘æ± </div></div>
          </label>
          <label style="display:flex;gap:10px;margin:8px 0;align-items:flex-start">
            <input type="radio" name="vowTarget" value="burn">
            <div><b>å¾€ç”Ÿåœ°å€ï¼ˆç‡ƒç‡’ï¼‰</b><div class="muted">ä¸å¯é€†ãƒ»è³ªèƒ½è½‰æ›</div></div>
          </label>
        </div>

        <div class="toast" id="sys">ç³»çµ±è¨Šæ¯ï¼šå°±ç·’</div>
      </div>

      <div class="card">
        <h2 style="margin:0 0 8px 0">æ‚Ÿç©ºèªéŸ³å®¢æœï¼ˆä¸€å•ä¸€ç­”ï¼‰</h2>
        <div class="muted">ä½ å¯ä»¥æ‰“å­—æˆ–ç”¨éº¥å…‹é¢¨ã€‚å®¢æœæœƒé¡¯ç¤ºæ–‡å­—ä¸¦ç”¨èªéŸ³èªªå‡ºä¾†ï¼ˆéœ€è¦ç€è¦½å™¨æˆæ¬Šï¼‰ã€‚</div>

        <div class="chat">
          <div class="chatHead">
            <b>æ¥å¾…å°</b>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button class="smallBtn" id="btnMic">ğŸ™ï¸ éº¥å…‹é¢¨</button>
              <button class="smallBtn" id="btnStop">â¹ï¸ åœæ­¢</button>
              <button class="smallBtn" id="btnClear">ğŸ§¹ æ¸…ç©º</button>
            </div>
          </div>
          <div class="chatBody" id="chatBody"></div>
          <div class="inputRow">
            <input id="chatInput" placeholder="è¼¸å…¥ï¼šæ€éº¼é ˜ç™¼è²¡é‡‘ï¼Ÿæ€éº¼æ–°å¢ KGENï¼Ÿæ€éº¼é‚„é¡˜ï¼Ÿ" />
            <button class="smallBtn" id="btnSend">é€å‡º</button>
          </div>
        </div>

        <div class="divider"></div>

        <h2 style="margin:0 0 8px 0">éˆä¸Šé©—è­‰å…¥å£ï¼ˆBscScanï¼‰</h2>
        <div class="muted">åœ°å€å¤ªé•·è‡ªå‹•å…©è¡Œé¡¯ç¤ºã€‚</div>
        <div style="margin-top:10px;display:grid;gap:8px">
          <div><b>KGEN</b>ï¼š<a class="addr addr2" id="lnkKgen" target="_blank" rel="noopener"></a></div>
          <div><b>Faucet</b>ï¼š<a class="addr addr2" id="lnkFaucet" target="_blank" rel="noopener"></a></div>
          <div><b>Bank</b>ï¼š<a class="addr addr2" id="lnkBank" target="_blank" rel="noopener"></a></div>
        </div>
      </div>
    </div>

    <div class="foot">
      PrimeForge ä»¥æ¯æ©Ÿä¹‹åï¼Œé–‹å•Ÿé‡‘èç”Ÿå‘½ã€‚<br>
      èŠ±æœå±±å°ç£ãƒ»ä¿¡å¿µä¸æ»…ãƒ»å¸‚å ´ç„¡ç•Œã€‚<br>
      Where the Market Becomes the Myth.<br>
      â€”â€” æ¨‚å¤©å¸ âŒ–
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script>
  (() => {
    // ====== å›ºå®šçœŸåœ°å€ï¼ˆä¸äº‚æ”¹ï¼‰======
    const CHAIN_ID_DEC = 56; // BSC
    const KGEN = "0xBA3d3810e58735cb6813bC1CDc5458C0d71432Be";
    const BANK = "0xfc522243e988a837700CaD600D6f030f5932681F";

    // Faucet = æ‚Ÿç©ºå¿ƒè‡Ÿï¼ˆéƒ¨ç½²å¾Œå¡«å…¥ï¼‰
    const FAUCET = ""; // TODO: deploy then fill

    const $ = (id)=>document.getElementById(id);
    const say = (t)=>{
      try{
        if(!("speechSynthesis" in window)) return;
        speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(t);
        u.lang="zh-TW";
        speechSynthesis.speak(u);
      }catch{}
    };
    const toast=(t)=>$("sys").textContent="ç³»çµ±è¨Šæ¯ï¼š"+t;

    $("kgenAddr").textContent = KGEN;
    $("faucetAddr").textContent = FAUCET ? FAUCET : "ï¼ˆå°šæœªè¨­å®šï¼‰";

    // BscScan links
    const bsc = (a)=>`https://bscscan.com/address/${a}`;
    $("lnkKgen").textContent=KGEN; $("lnkKgen").href=bsc(KGEN);
    $("lnkFaucet").textContent=FAUCET?FAUCET:"ï¼ˆå°šæœªè¨­å®šï¼‰";
    $("lnkFaucet").href=FAUCET?bsc(FAUCET):"https://bscscan.com/";
    $("lnkBank").textContent=BANK; $("lnkBank").href=bsc(BANK);

    // CountAPI breathing
    const NS="klineodyssey-wukong-temple";
    const dayKey=()=>{
      const d=new Date(), y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,"0"), dd=String(d.getDate()).padStart(2,"0");
      return `day_${y}${m}${dd}`;
    };
    const hit = async(key)=>{
      const r=await fetch(`https://api.countapi.xyz/hit/${encodeURIComponent(NS)}/${encodeURIComponent(key)}`);
      if(!r.ok) throw new Error("countapi");
      return await r.json();
    };
    (async()=>{
      try{
        const [a,b]=await Promise.all([hit(dayKey()),hit("total")]);
        $("kpiToday").textContent=String(a.value??0);
        $("kpiTotal").textContent=String(b.value??0);
      }catch{
        $("kpiToday").textContent="â€”"; $("kpiTotal").textContent="â€”";
      }
    })();

    // Chat concierge (scripted)
    const chat=$("chatBody");
    const esc=(s)=>String(s).replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m]));
    const add=(who,text)=>{
      const div=document.createElement("div");
      div.className="msg "+(who==="ä½ "?"me":"ai");
      div.innerHTML=`<div class="who">${esc(who)}</div><div>${esc(text).replace(/\n/g,"<br>")}</div>`;
      chat.appendChild(div); chat.scrollTop=chat.scrollHeight;
    };
    const answer=(q)=>{
      const s=q.trim();
      const has=(...k)=>k.some(x=>s.includes(x));
      if(has("ç™¼è²¡é‡‘","é ˜éŒ¢","æ€éº¼é ˜")) return "ç™¼è²¡é‡‘ç”± Faucetï¼ˆå¿ƒè‡Ÿåˆç´„ï¼‰å‡ºé‡‘ã€‚ç¾åœ¨ Faucet å°šæœªå¡«å…¥åœ°å€ï¼Œæ‰€ä»¥å…ˆåšå°è¦½èˆ‡éŒ¢åŒ…é€£ç·šã€‚éƒ¨ç½² Faucet å¾Œï¼Œæˆ‘æœƒæŠŠã€é ˜ç™¼è²¡é‡‘ã€æ¥åˆ°åˆç´„æ–¹æ³•ï¼ˆä½ åœ¨éŒ¢åŒ…æŒ‰ç¢ºèªï¼‰ã€‚";
      if(has("æ‰¾ä¸åˆ°","è‡ªè¨‚","ä»£å¹£","æ–°å¢","KGEN")) return "æ‰¾ä¸åˆ° KGENï¼šç”¨éŒ¢åŒ…ã€è‡ªè¨‚ä»£å¹£ã€æ–°å¢ï¼Œè²¼ä¸Š KGEN åˆç´„åœ°å€å³å¯ã€‚";
      if(has("é‚„é¡˜","æ")) return "é‚„é¡˜ä¸‰é“ï¼šA Faucetï¼ˆå¿ƒè‡Ÿãƒ»å‡ºå…¥å¾ªç’°ï¼‰B Bankï¼ˆåˆ¶åº¦å„²å‚™ï¼‰C ç‡ƒç‡’ï¼ˆä¸å¯é€†ï¼‰ã€‚é¸å¥½å¾ŒæŒ‰ã€é‚„é¡˜ã€ï¼ŒéŒ¢åŒ…æœƒè·³å‡ºç¢ºèªã€‚";
      if(has("å¿ƒè·³","å‘¼å¸","é»ç«")) return "å‘¼å¸ï¼ä¾†è¨ªè¨ˆæ•¸ã€‚å¿ƒè·³ï¼é»ç«äº‹ä»¶ï¼ˆéœ€è¦ Faucet åˆç´„ï¼‰ã€‚00:00 äº‹ä»¶èˆ‡æ¯æ©Ÿæ•‘æ´æ‡‰å¯«åœ¨ Faucet åˆç´„ä¸¦ç•™ä¸‹éˆä¸Šäº‹ä»¶ã€‚";
      return "ä½ å¯ä»¥å•ï¼šæ€éº¼é ˜ç™¼è²¡é‡‘ï¼Ÿæ€éº¼æ–°å¢ KGENï¼Ÿæ€éº¼é‚„é¡˜ï¼Ÿå¿ƒè·³å‘¼å¸æ˜¯ä»€éº¼ï¼Ÿ";
    };
    const reply=(q)=>{
      const a=answer(q);
      add("ä½ ",q); add("æ‚Ÿç©ºå®¢æœ",a); say(a);
    };
    $("btnSend").onclick=()=>{
      const v=$("chatInput").value.trim(); if(!v) return;
      $("chatInput").value=""; reply(v);
    };
    $("chatInput").addEventListener("keydown",(e)=>{ if(e.key==="Enter") $("btnSend").click(); });
    $("btnClear").onclick=()=>{ chat.innerHTML=""; toast("å·²æ¸…ç©ºå°è©±"); };
    $("btnStop").onclick=()=>{ try{ speechSynthesis.cancel(); }catch{} toast("å·²åœæ­¢èªéŸ³"); };

    // Mic
    const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
    let rec=null;
    if(SR){
      rec=new SR(); rec.lang="zh-TW"; rec.interimResults=false; rec.maxAlternatives=1;
      rec.onresult=(e)=>{ const t=e.results?.[0]?.[0]?.transcript||""; if(t) reply(t); else toast("è½ä¸æ¸…æ¥š"); };
      rec.onerror=()=>toast("éº¥å…‹é¢¨éŒ¯èª¤æˆ–æœªæˆæ¬Š");
      rec.onend=()=>{ $("btnMic").textContent="ğŸ™ï¸ éº¥å…‹é¢¨"; };
    }
    $("btnMic").onclick=()=>{
      if(!rec){ toast("æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜"); return; }
      try{ $("btnMic").textContent="ğŸ™ï¸ è†è½ä¸­â€¦"; rec.start(); toast("è«‹èªªè©±"); }catch{ toast("ç„¡æ³•å•Ÿå‹•éº¥å…‹é¢¨"); }
    };

    // Blueprint + Intro
    $("btnBlueprint").onclick=()=>{
      add("æ‚Ÿç©ºå®¢æœ","å»ºæ®¿è—åœ–ï¼š\n1 ä¸»æ®¿è£ä¿®èˆ‡å®¢æœ âœ…\n2 å‘¼å¸ï¼ˆä¾†è¨ªçµ±è¨ˆï¼‰âœ…\n3 å¿ƒè·³/ç™¼è²¡é‡‘ï¼ˆFaucet éƒ¨ç½²å¾Œæ¥ä¸Šï¼‰â³\n4 é‚„é¡˜ä¸‰é“ âœ…\n5 åšæ¯äº’å‹• âœ…\n6 æ›¸åŸå…¥å£ âœ…\nä¸‹ä¸€éšæ®µï¼šæœˆè€æ®¿/è§£ç±¤/å¤šæ®¿å¿ƒè‡Ÿ â³");
      toast("è—åœ–å·²é¡¯ç¤º"); say("å»ºæ®¿è—åœ–å·²é¡¯ç¤ºåœ¨å°è©±æ¡†ã€‚");
    };
    $("btnIntro").onclick=()=>{
      say("æ­¡è¿ä¾†åˆ°äº”æŒ‡å±±æ‚Ÿç©ºè²¡ç¥æ®¿ã€‚é€™è£¡æ˜¯äº’å‹•å¼éŠæˆ²å…¥å£ï¼Œä¸æ˜¯æŠ•è³‡å¹³å°ã€‚ä½ å¯ä»¥å…ˆé€£ç·šéŒ¢åŒ…ï¼ŒæŸ¥çœ‹ K G E Nï¼Œä¸¦é¸æ“‡é‚„é¡˜çš„é“è·¯ã€‚");
      toast("èªéŸ³å°è¦½å·²æ’­æ”¾");
    };

    // Wallet + ERC20
    let provider=null, signer=null, me=null;
    const ERC20_ABI=["function balanceOf(address) view returns (uint256)","function transfer(address,uint256) returns (bool)"];
    const ensureChain=async()=>{
      if(!window.ethereum) throw new Error("NO_WALLET");
      const want="0x"+CHAIN_ID_DEC.toString(16);
      const cur=await ethereum.request({method:"eth_chainId"});
      if(cur!==want) await ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:want}]});
    };
    const fmt=(bn)=>{ try{return ethers.utils.formatUnits(bn,18);}catch{return String(bn);} };

    const render=async()=>{
      if(!provider||!me) return;
      try{
        const token=new ethers.Contract(KGEN,ERC20_ABI,provider);
        const my=await token.balanceOf(me);
        const bank=await token.balanceOf(BANK);
        let line=`ä½ ï¼š${fmt(my)} KGEN ï½œ éŠ€è¡Œï¼š${fmt(bank)} KGEN`;
        if(FAUCET){
          const f=await token.balanceOf(FAUCET);
          line += ` ï½œ Faucetï¼š${fmt(f)} KGEN`;
          $("kpiIgnite").textContent="å¾…æ¥ä¸ŠéˆæŸ¥è©¢";
        }
        $("balances").textContent=line;
      }catch{
        $("balances").textContent="é¤˜é¡è®€å–å¤±æ•—ï¼šè«‹ç¢ºèªå·²åœ¨ BSC ä¸»ç¶²";
      }
    };

    $("btnConnect").onclick=async()=>{
      try{
        if(!window.ethereum){ toast("æ‰¾ä¸åˆ°éŒ¢åŒ…ï¼šè«‹ç”¨ MetaMask æˆ–éŒ¢åŒ…ç€è¦½å™¨"); return; }
        await ensureChain();
        provider=new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts",[]);
        signer=provider.getSigner();
        me=await signer.getAddress();
        $("walletState").textContent="å·²é€£ç·šï¼ˆBSCï¼‰";
        $("meAddr").textContent=me;
        toast("éŒ¢åŒ…å·²é€£ç·š");
        await render();
      }catch{ toast("é€£ç·šå¤±æ•—æˆ–æœªæˆæ¬Š"); }
    };

    $("btnAddToken").onclick=()=>{
      add("æ‚Ÿç©ºå®¢æœ","æ–°å¢ KGENï¼šåˆ°éŒ¢åŒ…çš„è‡ªè¨‚ä»£å¹£ï¼Œè²¼ä¸Š KGEN åˆç´„åœ°å€å³å¯ã€‚\n"+KGEN);
      toast("å·²é¡¯ç¤ºæç¤º"); say("è«‹ç”¨è‡ªè¨‚ä»£å¹£æ–°å¢ K G E Nã€‚");
    };

    const target=()=>{
      const v=document.querySelector('input[name="vowTarget"]:checked')?.value||"faucet";
      if(v==="bank") return BANK;
      if(v==="burn") return "0x0000000000000000000000000000000000000000";
      return FAUCET||"";
    };

    $("btnVow").onclick=async()=>{
      try{
        if(!signer||!me){ toast("è«‹å…ˆé€£ç·šéŒ¢åŒ…"); return; }
        const to=target();
        if(!to){ toast("Faucet å°šæœªè¨­å®šï¼šç›®å‰ç„¡æ³•å›è£œå¿ƒè‡Ÿåœ°å€"); return; }
        const amt=prompt("è¼¸å…¥é‚„é¡˜æ•¸é‡ï¼ˆKGENï¼‰ï¼Œä¾‹å¦‚ 1 æˆ– 0.5","1");
        if(!amt) return;
        const value=ethers.utils.parseUnits(String(amt),18);
        const token=new ethers.Contract(KGEN,ERC20_ABI,signer);
        const tx=await token.transfer(to,value);
        toast("äº¤æ˜“å·²é€å‡ºï¼šç­‰å¾…éˆä¸Šç¢ºèª");
        await tx.wait();
        toast("é‚„é¡˜å®Œæˆï¼ˆå·²ä¸Šéˆï¼‰");
        await render();
      }catch{ toast("é‚„é¡˜å–æ¶ˆæˆ–å¤±æ•—"); }
    };

    $("btnFortune").onclick=()=>{
      if(!FAUCET){
        add("æ‚Ÿç©ºå®¢æœ","ç™¼è²¡é‡‘éœ€è¦ Faucetï¼ˆå¿ƒè‡Ÿåˆç´„ï¼‰éƒ¨ç½²ä¸¦å¡«å…¥åœ°å€ï¼Œæ‰æœƒçœŸæ­£å‡ºé‡‘ã€‚");
        toast("å°šæœªè¨­å®š Faucet"); say("ç™¼è²¡é‡‘éœ€è¦ Faucet åˆç´„éƒ¨ç½²å¾Œæ‰èƒ½å‡ºé‡‘ã€‚");
        return;
      }
      add("æ‚Ÿç©ºå®¢æœ","Faucet å·²è¨­å®šã€‚ä¸‹ä¸€æ­¥è¦æŠŠ Faucet ABI èˆ‡æ–¹æ³•åç¨±ç¢ºèªï¼Œæˆ‘å°±èƒ½æŠŠæŒ‰éˆ•æ¥åˆ° igniteAndClaimã€‚");
      toast("Faucet å·²è¨­å®šï¼ˆå¾…æ¥ ABIï¼‰");
    };

    // BoBei mini-game
    const KEY="wukong_boBei_v2_2";
    const st=JSON.parse(localStorage.getItem(KEY)||'{"wins":0,"tries":0}');
    const save=()=>localStorage.setItem(KEY,JSON.stringify(st));
    const boBei=()=>{
      const a=Math.random()<.5?0:1,b=Math.random()<.5?0:1;
      if(a===1&&b===1) return "è–ç­Š";
      if(a===0&&b===0) return "ç¬‘ç­Š";
      return "é™°ç­Š";
    };
    $("btnBoBei").onclick=()=>{
      const r=boBei();
      st.tries++; if(r==="è–ç­Š") st.wins++; save();
      const msg=`åšæ¯çµæœï¼š${r}ï¼ˆç´¯è¨ˆï¼š${st.wins} è–ç­Š / ${st.tries} æ¬¡ï¼‰`;
      add("æ‚Ÿç©ºå®¢æœ",msg); toast(msg); say(msg);
    };

    add("æ‚Ÿç©ºå®¢æœ","æ­¡è¿ä¾†åˆ°äº”æŒ‡å±±æ‚Ÿç©ºè²¡ç¥æ®¿ã€‚å…ˆæŒ‰ã€é€£ç·šéŒ¢åŒ…ã€ï¼Œæˆ–ç›´æ¥å•æˆ‘ï¼šæ€éº¼é ˜ç™¼è²¡é‡‘ï¼Ÿ");
  })();
  </script>
</body>
</html>
