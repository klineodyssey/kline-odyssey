<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>èŠ±æœå±±ç«æ˜Ÿé½Šå¤©è±ªå®… 108000ï½œMars Seats V2.2ï¼ˆTemple UI V1.0ï¼‰</title>

  <!-- Ethers v5.7.2ï¼šå„ªå…ˆæœ¬åœ°æª” ./ethers-5.7.2.umd.min.jsï¼Œè‹¥ç¼ºå°‘å‰‡è‡ªå‹• CDN å‚™æ´ -->
  <script>
    (function(){
      function add(src){
        return new Promise((res, rej)=>{
          var s=document.createElement('script');
          s.src=src; s.async=true;
          s.onload=res; s.onerror=rej;
          document.head.appendChild(s);
        });
      }
      var local = "./ethers-5.7.2.umd.min.js";
      var cdn   = "https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js";
      add(local).catch(()=>add(cdn)).catch(()=>console.warn("ethers load failed"));
    })();
  </script>

  <style>
    :root{
      --bg0:#05060a;
      --bg1:#0b0f1a;
      --gold:#ffd56a;
      --gold2:#ffb74a;
      --cyan:#7cf6ff;
      --muted:rgba(255,255,255,.72);
      --card:rgba(255, 213, 106, .06);
      --card2:rgba(124, 246, 255, .06);
      --line:rgba(255, 213, 106, .28);
      --shadow: 0 14px 60px rgba(0,0,0,.55);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: "Microsoft JhengHei", system-ui, -apple-system, Segoe UI, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 20% 20%, #121a2e 0%, var(--bg0) 55%) , radial-gradient(900px 600px at 80% 70%, #1a1133 0%, var(--bg0) 55%);
      color: #fff;
      overflow-x:hidden;
    }

    /* Starfield */
    .stars, .stars2, .stars3{
      position:fixed; inset:0;
      background-repeat:repeat;
      pointer-events:none;
      z-index:-1;
      opacity:.75;
    }
    .stars{ background-image: radial-gradient(#ffffff 1px, transparent 1px); background-size: 140px 140px; animation: drift 120s linear infinite;}
    .stars2{ background-image: radial-gradient(#7cf6ff 1px, transparent 1px); background-size: 220px 220px; opacity:.35; animation: drift 180s linear infinite reverse;}
    .stars3{ background-image: radial-gradient(#ffd56a 1px, transparent 1px); background-size: 320px 320px; opacity:.20; animation: drift 240s linear infinite;}
    @keyframes drift { from{ transform: translate3d(0,0,0)} to{ transform: translate3d(-800px, -600px, 0)} }

    .wrap{ max-width: 1080px; margin: 0 auto; padding: 18px 14px 60px; }

    /* Top bar */
    .topbar{
      position: sticky; top: 10px; z-index: 9999;
      display:flex; gap:10px; justify-content: space-between; align-items:center;
      padding: 10px 10px;
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 999px;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 40px rgba(0,0,0,.35);
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 14px; border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      text-decoration:none;
      color:#fff;
      font-weight:800;
      cursor:pointer;
      user-select:none;
    }
    .pill:hover{ background: rgba(255,255,255,.10); }
    .pill.gold{ border-color: rgba(255,213,106,.45); }
    .pill.cyan{ border-color: rgba(124,246,255,.45); }
    .right{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end; }
    .tag{
      font-weight:900; letter-spacing:.6px;
      color: var(--gold);
      padding: 8px 12px;
      border: 1px solid rgba(255,213,106,.25);
      border-radius: 999px;
      background: rgba(255,213,106,.06);
    }

    header{ padding: 18px 0 6px; text-align:left; }
    h1{
      margin: 10px 0 8px;
      font-size: 30px;
      color: var(--gold);
      text-shadow: 0 0 24px rgba(255,213,106,.28);
      letter-spacing: .8px;
      line-height: 1.15;
    }
    .sub{
      color: rgba(255,255,255,.78);
      font-size: 13px;
      line-height: 1.6;
    }
    .sub b{ color: var(--cyan); }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 14px;
      margin-top: 14px;
    }
    @media (max-width: 900px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06) 0%, rgba(0,0,0,.14) 100%);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 14px;
    }
    .card.gold{ border-color: rgba(255,213,106,.22); }
    .card.cyan{ border-color: rgba(124,246,255,.22); }

    .card h2{
      margin: 0 0 10px;
      font-size: 16px;
      color: #fff;
      letter-spacing:.5px;
    }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .kpi{
      flex: 1 1 200px;
      background: rgba(255,213,106,.06);
      border: 1px solid rgba(255,213,106,.18);
      border-radius: 14px;
      padding: 12px;
      min-width: 220px;
    }
    .kpi .label{ font-size:12px; color: rgba(255,255,255,.72); }
    .kpi .value{ font-size:20px; font-weight:900; color: var(--gold); margin-top:6px; }
    .kpi .hint{ font-size:12px; color: rgba(255,255,255,.68); margin-top:6px; line-height:1.4; }
    .kpi.cyanish{
      background: rgba(124,246,255,.06);
      border-color: rgba(124,246,255,.18);
    }
    .kpi.cyanish .value{ color: var(--cyan); }

    .btn{
      appearance:none;
      border: 1px solid rgba(255,213,106,.35);
      background: rgba(255,213,106,.10);
      color: #fff;
      border-radius: 12px;
      padding: 10px 12px;
      font-weight: 900;
      cursor:pointer;
    }
    .btn:hover{ background: rgba(255,213,106,.16); }
    .btn.cyan{ border-color: rgba(124,246,255,.35); background: rgba(124,246,255,.10); }
    .btn.cyan:hover{ background: rgba(124,246,255,.16); }
    .btn.danger{ border-color: rgba(255,80,80,.35); background: rgba(255,80,80,.10); }
    .btn.danger:hover{ background: rgba(255,80,80,.16); }

    input, textarea, select{
      width: 100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.25);
      color:#fff;
      outline:none;
    }
    textarea{ min-height: 86px; resize: vertical; }

    .small{ font-size:12px; color: rgba(255,255,255,.72); line-height:1.5; }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .sep{ height: 1px; background: rgba(255,255,255,.10); margin: 12px 0; }

    .addr{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 12px;
      padding: 10px 12px;
    }
    .addr code{
      font-size: 12px;
      word-break: break-all;
      color: rgba(255,255,255,.86);
    }
    .toast{
      position: fixed; right: 12px; bottom: 12px;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(0,0,0,.75);
      border: 1px solid rgba(255,255,255,.14);
      color:#fff;
      font-size: 12px;
      max-width: 360px;
      display:none;
      z-index: 99999;
      backdrop-filter: blur(10px);
    }

    .footer{
      margin-top: 18px;
      padding: 14px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
      color: rgba(255,255,255,.72);
      line-height: 1.7;
      font-size: 12px;
    }
  </style>
</head>

<body>
  <div class="stars"></div><div class="stars2"></div><div class="stars3"></div>

  <div class="wrap">

    <div class="topbar">
      <div class="left">
        <span class="tag">MARS 108000ï½œ500 å¸­ä½è±ªå®…</span>
      </div>
      <div class="right">
        <a class="pill gold" href="https://klineodyssey.github.io/kline-odyssey/" target="_blank" rel="noopener">ğŸŒ Official Website</a>
        <button class="pill cyan" id="btnConnect">ğŸª é€£æ¥éŒ¢åŒ…</button>
        <button class="pill" id="btnRefresh">ğŸ”„ é‡æ–°æ•´ç†</button>
      </div>
    </div>

    <header>
      <h1>èŠ±æœå±±ç«æ˜Ÿé½Šå¤©è±ªå®… 108000</h1>
      <div class="sub">
        åˆç´„ï¼š<b>MarsSeats V2.2</b>ï½œå¸­ä½ï¼š<b>500</b>ï½œå…¥ä½ï¼š<b>5000 K G E N</b><br/>
        é€™è£¡æ˜¯ã€Œå¸­ä½ç³»çµ±ã€ï¼šå…¥ä½å–å¾—å¸­ä½ NFT-likeï¼ˆseatIdï¼‰ï¼Œæœˆçµç®—åˆ†æ½¤ç”¨ <b>claim</b> è‡ªé ˜ï¼Œä¸æœƒä¸€æ¬¡ç¾¤ç™¼çˆ†ç‚¸ã€‚<br/>
        é‡è¦ï¼šæœ¬é åƒ…æä¾›éˆä¸Šäº’å‹•ï¼Œä¸æä¾›æŠ•è³‡æ‰¿è«¾èˆ‡æ”¶ç›Šä¿è­‰ã€‚
      </div>
    </header>

    <div class="grid">

      <div class="card gold">
        <h2>åˆç´„èˆ‡ç‹€æ…‹</h2>

        <div class="row">
          <div class="kpi">
            <div class="label">éŒ¢åŒ…</div>
            <div class="value mono" id="wallet">æœªé€£ç·š</div>
            <div class="hint">è«‹ç”¨ MetaMaskï¼ˆBSC Mainnet / chainId 56ï¼‰</div>
          </div>
          <div class="kpi cyanish">
            <div class="label">å¸­ä½å‰©é¤˜</div>
            <div class="value" id="remain">â€”</div>
            <div class="hint">500 - totalMinted</div>
          </div>
        </div>

        <div class="sep"></div>

        <div class="row">
          <div class="kpi">
            <div class="label">æˆ‘çš„å¸­ä½</div>
            <div class="value" id="mySeats">â€”</div>
            <div class="hint">æŸ¥è©¢ä½ çš„ seatIdsï¼ˆç°¡åŒ–é¡¯ç¤ºï¼šæ•¸é‡ + å‰ 10 å€‹ seatIdï¼‰</div>
          </div>
          <div class="kpi cyanish">
            <div class="label">å¯é ˜åˆ†æ½¤</div>
            <div class="value" id="pending">â€”</div>
            <div class="hint">pendingReward(user)ï¼ˆå–®ä½ï¼šKGENï¼‰</div>
          </div>
        </div>

        <div class="sep"></div>

        <h2>å¿«é€Ÿæ“ä½œ</h2>

        <div class="row">
          <button class="btn cyan" id="btnApprove">1) æˆæ¬Š 5000 KGEN</button>
          <button class="btn" id="btnBuy">2) å…¥ä½ï¼ˆé‘„é€ å¸­ä½ï¼‰</button>
          <button class="btn cyan" id="btnClaim">3) é ˜åˆ†æ½¤ï¼ˆClaimï¼‰</button>
        </div>

        <div class="small" style="margin-top:10px;">
          ä½ æœƒçœ‹åˆ°éˆä¸Šäº‹ä»¶ï¼š<span class="mono">SeatMinted</span> / <span class="mono">RewardNotified</span> / <span class="mono">RewardClaimed</span>ã€‚<br/>
          è‹¥ä½ æƒ³æŠŠã€Œå…¥ä½æ¬¾ã€æ‰“é€²äº¤æ˜“æ‰€ï¼ˆ11520 Brainï¼‰ï¼Œè«‹æŠŠ MarsSeats çš„ <span class="mono">treasury</span> è¨­ç‚º BrainExchange åˆç´„åœ°å€ï¼ˆæ›´ä¹¾æ·¨ï¼‰ï¼Œä¸è¦æŠŠã€ŒMars åˆç´„åœ°å€ã€ç•¶æˆäº¤æ˜“æ‰€åœ°å€ã€‚
        </div>

        <div class="sep"></div>

        <h2>åœ°å€ï¼ˆå¯ä¸€éµè¤‡è£½ï¼‰</h2>

        <div class="addr">
          <div class="small" style="min-width:80px;">KGEN</div>
          <code class="mono" id="addrKGEN">ï¼ˆå¡«å…¥ä½ çš„ KGEN Tokenï¼‰</code>
          <button class="btn" data-copy="#addrKGEN">Copy</button>
        </div>

        <div class="addr" style="margin-top:10px;">
          <div class="small" style="min-width:80px;">MarsSeats</div>
          <code class="mono" id="addrMARS">ï¼ˆå¡«å…¥ä½ éƒ¨ç½²å¾Œçš„ MarsSeatsï¼‰</code>
          <button class="btn" data-copy="#addrMARS">Copy</button>
        </div>

        <div class="addr" style="margin-top:10px;">
          <div class="small" style="min-width:80px;">Treasury</div>
          <code class="mono" id="addrTREAS">ï¼ˆå¯è¨­ç‚º BrainExchange æˆ–å…¬ç›Šåº«ï¼‰</code>
          <button class="btn" data-copy="#addrTREAS">Copy</button>
        </div>

        <div class="sep"></div>

        <h2>æ–°æ‰‹å°è¦½ï¼ˆå¾æ²’éŒ¢åŒ…åˆ°å…¥ä½ï¼‰</h2>
        <ol class="small">
          <li>æ‰‹æ©Ÿ/é›»è…¦å®‰è£ MetaMaskï¼Œæ–°å¢ç¶²è·¯ BNB Chainï¼ˆBSC / chainId 56ï¼‰ã€‚</li>
          <li>éŒ¢åŒ…è£¡æº–å‚™å°‘é‡ BNB ä½œç‚º Gasï¼ˆäº¤æ˜“æ‰‹çºŒè²»ï¼‰ã€‚</li>
          <li>æŠŠ KGEN åŠ å…¥éŒ¢åŒ…ï¼ˆè‡ªè¨‚ä»£å¹£ï¼šè²¼ä¸Š KGEN Token åœ°å€ï¼‰ã€‚</li>
          <li>æŒ‰ã€Œé€£æ¥éŒ¢åŒ…ã€ï¼Œå†æŒ‰ã€Œæˆæ¬Š 5000 KGENã€ï¼ŒMetaMask æœƒè·³å‡ºç¢ºèªã€‚</li>
          <li>æˆæ¬ŠæˆåŠŸå¾ŒæŒ‰ã€Œå…¥ä½ã€ï¼ŒæˆåŠŸæœƒé‘„é€ å¸­ä½ï¼ˆseatIdï¼‰ã€‚</li>
          <li>ä¹‹å¾Œæ¯æœˆåˆ†æ½¤ç”±äº¤æ˜“æ‰€å¤§è…¦æ’¥æ¬¾åˆ° MarsSeatsï¼Œä½ æŒ‰ã€Œé ˜åˆ†æ½¤ã€è‡ªé ˜ã€‚</li>
        </ol>
      </div>

      <div class="card cyan">
        <h2>è¨­å®šå€ï¼ˆéƒ¨ç½²å¾Œå¿…å¡«ï¼‰</h2>

        <div class="small">æŠŠä½ éƒ¨ç½²å¾Œçš„åœ°å€è²¼ä¸Šä¾†ï¼Œæœ¬é å°±èƒ½ç›´æ¥å°æ¥ï¼ˆå‰ç«¯ä¸éœ€è¦æ”¹ç¨‹å¼ï¼‰ã€‚</div>

        <div class="sep"></div>

        <label class="small">KGEN Token Address</label>
        <input class="mono" id="inKGEN" placeholder="0x..." />

        <label class="small" style="margin-top:10px;">MarsSeats Contract Address</label>
        <input class="mono" id="inMARS" placeholder="0x..." />

        <label class="small" style="margin-top:10px;">Treasury Addressï¼ˆå…¥ä½æ¬¾æµå‘ï¼‰</label>
        <input class="mono" id="inTREAS" placeholder="0x..." />

        <div class="row" style="margin-top:10px;">
          <button class="btn cyan" id="btnApply">å¥—ç”¨è¨­å®š</button>
          <button class="btn danger" id="btnReset">é‡ç½®</button>
        </div>

        <div class="sep"></div>

        <h2>å¸¸è¦‹å•é¡Œ</h2>
        <div class="small">
          <b>Qï¼šå¦‚æœæŠŠ treasury è¨­ç‚ºäº¤æ˜“æ‰€åœ°å€ï¼Œé‚£ç¹³ 5000 KGEN äº¤æ˜“æ‰€æ€éº¼çŸ¥é“æ˜¯ä½è±ªå®…çš„éŒ¢é‚„æ˜¯ä¿è­‰é‡‘ï¼Ÿ</b><br/><br/>
          <b>æ¨è–¦åšæ³•ï¼š</b><br/>
          1) è®“ MarsSeats çš„ treasury ç›´æ¥æ˜¯ BrainExchange åˆç´„åœ°å€ã€‚<br/>
          2) BrainExchange å¢åŠ å°ˆç”¨å…¥å£ï¼š<span class="mono">depositFromMars(address user, uint256 amount)</span>ï¼Œåªå…è¨± msg.sender == MarsSeatsã€‚<br/>
          3) MarsSeats åœ¨ mintSeat å¾Œç”±åˆç´„å‘¼å« Brain å…¥å£ï¼Œè®“ Brain å¸³æœ¬å¯åˆ†é¡ï¼Œä¸æ··ä¿è­‰é‡‘ã€‚<br/><br/>
          è‹¥ä½ æš«æ™‚åªåšã€Œç´”è½‰å¸³åˆ° Brainã€ï¼Œä¹Ÿå¯ä»¥é äº‹ä»¶è¿½è¹¤ï¼Œä½†éˆä¸Šå¸³æœ¬åˆ†é¡æœƒä¸ä¹¾æ·¨ã€‚
        </div>

      </div>

    </div>

    <div class="footer">
      PrimeForge ä»¥æ¯æ©Ÿä¹‹åï¼Œé–‹å•Ÿé‡‘èç”Ÿå‘½ã€‚<br/>
      èŠ±æœå±±å°ç£ãƒ»ä¿¡å¿µä¸æ»…ãƒ»å¸‚å ´ç„¡ç•Œã€‚<br/>
      Where the Market Becomes the Myth.<br/>
      â€”â€” æ¨‚å¤©å¸ âŒ–
    </div>

  </div>

  <div class="toast" id="toast"></div>

<script>
/** ===============================
 *  Mars Seats Temple UI V1.0
 * =============================== */

const LS_KEY = "KLINE_MARS_SEATS_UI_V1";
const DEFAULTS = { kgen:"", mars:"", treasury:"" };

let provider, signer, walletAddress = "";
let KGEN, MARS;

function toast(msg){
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.style.display = "block";
  clearTimeout(window.__toastTimer);
  window.__toastTimer = setTimeout(()=> t.style.display="none", 2600);
}

function isAddr(x){
  try{ return ethers.utils.isAddress((x||"").trim()); }catch(e){ return false; }
}

function loadCfg(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    return raw ? Object.assign({}, DEFAULTS, JSON.parse(raw)) : {...DEFAULTS};
  }catch(e){
    return {...DEFAULTS};
  }
}
function saveCfg(cfg){ localStorage.setItem(LS_KEY, JSON.stringify(cfg)); }

function applyCfgToUI(cfg){
  document.getElementById("inKGEN").value = cfg.kgen || "";
  document.getElementById("inMARS").value = cfg.mars || "";
  document.getElementById("inTREAS").value = cfg.treasury || "";
  document.getElementById("addrKGEN").textContent = cfg.kgen || "ï¼ˆå¡«å…¥ä½ çš„ KGEN Tokenï¼‰";
  document.getElementById("addrMARS").textContent = cfg.mars || "ï¼ˆå¡«å…¥ä½ éƒ¨ç½²å¾Œçš„ MarsSeatsï¼‰";
  document.getElementById("addrTREAS").textContent = cfg.treasury || "ï¼ˆå¯è¨­ç‚º BrainExchange æˆ–å…¬ç›Šåº«ï¼‰";
}

function requireCfgReady(cfg){
  if(!isAddr(cfg.kgen)) throw new Error("KGEN åœ°å€æœªå¡«æˆ–ä¸åˆæ³•");
  if(!isAddr(cfg.mars)) throw new Error("MarsSeats åœ°å€æœªå¡«æˆ–ä¸åˆæ³•");
}

const ABI_KGEN = [
  "function allowance(address owner, address spender) view returns (uint256)",
  "function approve(address spender, uint256 amount) returns (bool)"
];

const ABI_MARS = [
  "function remainingSeats() view returns (uint256)",
  "function pendingReward(address user) view returns (uint256)",
  "function treasury() view returns (address)",
  "function mintSeat()",
  "function claimReward()",
  "function seatsOf(address user) view returns (uint256[] memory)"
];

async function connect(){
  if(!window.ethereum) throw new Error("æœªåµæ¸¬åˆ°éŒ¢åŒ…ï¼ˆè«‹å®‰è£ MetaMaskï¼‰");
  provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = provider.getSigner();
  walletAddress = await signer.getAddress();
  document.getElementById("wallet").textContent = walletAddress;
  toast("éŒ¢åŒ…å·²é€£ç·š");
}

async function bindContracts(){
  const cfg = loadCfg();
  requireCfgReady(cfg);
  if(!provider || !signer) throw new Error("è«‹å…ˆé€£æ¥éŒ¢åŒ…");
  KGEN = new ethers.Contract(cfg.kgen, ABI_KGEN, signer);
  MARS = new ethers.Contract(cfg.mars, ABI_MARS, signer);
}

function fmt18(x){
  try{ return ethers.utils.formatUnits(x, 18); }catch(e){ return String(x); }
}
function fmtKgen(x){
  const n = Number(fmt18(x));
  if(Number.isNaN(n)) return "â€”";
  return n.toLocaleString(undefined, {maximumFractionDigits: 6});
}

async function refresh(){
  const cfg = loadCfg();
  applyCfgToUI(cfg);
  if(!provider || !signer || !walletAddress) return;

  await bindContracts();

  const [remain, pending] = await Promise.all([
    MARS.remainingSeats(),
    MARS.pendingReward(walletAddress).catch(()=>ethers.BigNumber.from(0))
  ]);

  document.getElementById("remain").textContent = `${remain.toString()} / 500`;
  document.getElementById("pending").textContent = `${fmtKgen(pending)} KGEN`;

  // seats
  let seats = [];
  try{ seats = await MARS.seatsOf(walletAddress); }catch(e){ seats = []; }
  const seatIds = (seats||[]).map(s=>s.toString());
  const preview = seatIds.slice(0,10).join(", ");
  document.getElementById("mySeats").textContent = seatIds.length ? `${seatIds.length} å¸­ï¼ˆ${preview}${seatIds.length>10?"â€¦":""}ï¼‰` : "0 å¸­";

  // treasury in chain
  try{
    const treas = await MARS.treasury();
    document.getElementById("addrTREAS").textContent = treas;
  }catch(e){}
}

async function approve5000(){
  const cfg = loadCfg();
  await bindContracts();
  const amount = ethers.utils.parseUnits("5000", 18);
  const allowance = await KGEN.allowance(walletAddress, cfg.mars);
  if(allowance.gte(amount)){
    toast("å·²æˆæ¬Šè¶³å¤ ï¼ˆ5000 KGENï¼‰");
    return;
  }
  const tx = await KGEN.approve(cfg.mars, amount);
  toast("é€å‡ºæˆæ¬Šäº¤æ˜“â€¦");
  await tx.wait();
  toast("æˆæ¬Šå®Œæˆ");
}

async function buySeat(){
  await bindContracts();
  const tx = await MARS.mintSeat();
  toast("é€å‡ºå…¥ä½äº¤æ˜“â€¦");
  await tx.wait();
  toast("å…¥ä½æˆåŠŸï¼ˆå¸­ä½å·²é‘„é€ ï¼‰");
  await refresh();
}

async function claim(){
  await bindContracts();
  const tx = await MARS.claimReward();
  toast("é€å‡ºé ˜åˆ†æ½¤äº¤æ˜“â€¦");
  await tx.wait();
  toast("é ˜å–å®Œæˆ");
  await refresh();
}

/* Copy buttons */
document.addEventListener("click", async (e)=>{
  const el = e.target;
  if(el && el.dataset && el.dataset.copy){
    const sel = el.dataset.copy;
    const node = document.querySelector(sel);
    const text = (node && node.textContent) ? node.textContent.trim() : "";
    if(!text) return toast("æ²’æœ‰å¯è¤‡è£½å…§å®¹");
    try{
      await navigator.clipboard.writeText(text);
      toast("å·²è¤‡è£½");
    }catch(err){
      toast("è¤‡è£½å¤±æ•—ï¼ˆç€è¦½å™¨é™åˆ¶ï¼‰");
    }
  }
});

document.getElementById("btnConnect").addEventListener("click", async ()=>{
  try{ await connect(); await refresh(); }catch(e){ toast(e.message || String(e)); }
});
document.getElementById("btnRefresh").addEventListener("click", async ()=>{
  try{ await refresh(); }catch(e){ toast(e.message || String(e)); }
});

document.getElementById("btnApply").addEventListener("click", async ()=>{
  const cfg = loadCfg();
  const k = document.getElementById("inKGEN").value.trim();
  const m = document.getElementById("inMARS").value.trim();
  const t = document.getElementById("inTREAS").value.trim();

  if(k && !isAddr(k)) return toast("KGEN åœ°å€ä¸åˆæ³•");
  if(m && !isAddr(m)) return toast("MarsSeats åœ°å€ä¸åˆæ³•");
  if(t && !isAddr(t)) return toast("Treasury åœ°å€ä¸åˆæ³•");

  cfg.kgen = k || cfg.kgen;
  cfg.mars = m || cfg.mars;
  cfg.treasury = t || cfg.treasury;

  saveCfg(cfg);
  applyCfgToUI(cfg);
  toast("è¨­å®šå·²å¥—ç”¨");
  try{ await refresh(); }catch(e){}
});

document.getElementById("btnReset").addEventListener("click", ()=>{
  localStorage.removeItem(LS_KEY);
  applyCfgToUI({...DEFAULTS});
  toast("å·²é‡ç½®");
});

document.getElementById("btnApprove").addEventListener("click", async ()=>{
  try{ await approve5000(); }catch(e){ toast(e.message || String(e)); }
});
document.getElementById("btnBuy").addEventListener("click", async ()=>{
  try{ await buySeat(); }catch(e){ toast(e.message || String(e)); }
});
document.getElementById("btnClaim").addEventListener("click", async ()=>{
  try{ await claim(); }catch(e){ toast(e.message || String(e)); }
});

(function init(){
  const cfg = loadCfg();
  applyCfgToUI(cfg);
})();
</script>

</body>
</html>
